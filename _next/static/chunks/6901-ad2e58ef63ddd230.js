"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6901],{1409:function(e,t,n){function r(e){let{src:t,width:n,quality:r}=e;return"".concat("").concat(t)}n.r(t),n.d(t,{default:function(){return r}})},5202:function(e,t,n){n.d(t,{Z:function(){return d}});var r=n(7437),c=n(2265),o=n(5606),i=n(516),a=n(2808),l=n(7143),s=n(6648),u=n(4379),h=n.n(u);function d(e){let{isStudy:t}=e,[n,u]=(0,c.useState)(null);(0,c.useRef)(null),(0,c.useEffect)(()=>{let e=localStorage.getItem("userLogin");if(e){let n=JSON.parse(e);if(u(n),!t)return;(0,o.o3)(n.uid,o.db)}},[t]),(0,c.useEffect)(()=>(window.addEventListener("beforeunload",d),()=>window.removeEventListener("beforeunload",d)),[]);let d=async()=>{let e=JSON.parse(localStorage.getItem("userLogin"));e&&await (0,o.Z3)(e.uid,o.db)};(0,c.useEffect)(()=>{if(!n||!t)return;let e=setInterval(()=>{(async()=>{await (0,o.Z3)(n.uid,o.db),(await h().fire({title:"\uD83E\uDDE0 Bạn vẫn đang học chứ?",text:"Vui l\xf2ng x\xe1c nhận để tiếp tục phi\xean học.",icon:"question",showCancelButton:!0,confirmButtonText:"Đang học",cancelButtonText:"Tạm nghỉ"})).isConfirmed?(await (0,o.o3)(n.uid,o.db),console.log("✅ Người d\xf9ng x\xe1c nhận đang học")):console.log("⏸️ Người d\xf9ng tạm nghỉ")})()},18e5);return()=>clearInterval(e)},[n]);let g=async()=>{try{let e=await (0,o.Cb)();console.log(e);let t=e.user,n="user/account/".concat(t.uid),r=(0,i.iH)(o.db,n);if((await (0,i.U2)(r)).exists())console.log("\uD83D\uDCE6 User đ\xe3 tồn tại tr\xean Realtime Database");else{let e={uid:t.uid,name:t.displayName,email:t.email,photoURL:t.photoURL,createdAt:new Date().toISOString()};await (0,i.t8)(r,e),console.log("\uD83C\uDD95 Tạo user mới tr\xean Realtime Database")}let c={uid:t.uid,name:t.displayName,email:t.email,photoURL:t.photoURL};localStorage.setItem("userLogin",JSON.stringify(c)),u(c),await (0,o.o3)(t.uid)}catch(e){console.error("❌ Lỗi đăng nhập:",e)}},f=async()=>{let e=JSON.parse(localStorage.getItem("userLogin"));e&&await (0,o.Z3)(e.uid,o.db),(0,o.kS)(),localStorage.removeItem("userLogin"),u(null)};return(0,r.jsx)("div",{className:"d-flex align-items-center gap-3",children:n?(0,r.jsxs)("div",{className:"d-flex align-items-center position-relative",children:[(0,r.jsx)("span",{className:"me-2 fw-semibold text-white d-none d-sm-inline",children:n.name}),(0,r.jsxs)(l.Z,{align:"end",children:[(0,r.jsx)(l.Z.Toggle,{variant:"light",id:"dropdown-avatar",className:"p-0 border-0 bg-transparent",children:(0,r.jsx)(s.default,{src:n.photoURL,alt:"avatar",width:"40",height:"40",className:"rounded-circle border border-1"})}),(0,r.jsxs)(l.Z.Menu,{children:[(0,r.jsx)(l.Z.Item,{href:"/profile",children:"Trang c\xe1 nh\xe2n"}),(0,r.jsx)(l.Z.Divider,{}),(0,r.jsx)(l.Z.Item,{onClick:()=>f(),children:"Đăng xuất"})]})]})]}):(0,r.jsx)(a.Z,{onClick:()=>g(),className:"btn btn-primary",children:"Đăng nhập bằng Google"})})}},5606:function(e,t,n){n.d(t,{Cb:function(){return k},F3:function(){return m},Gd:function(){return v},Je:function(){return s},Pf:function(){return h},Tn:function(){return u},UD:function(){return S},VP:function(){return f},Z3:function(){return I},Z6:function(){return g},_g:function(){return d},db:function(){return l},eO:function(){return w},kS:function(){return D},kX:function(){return p},o3:function(){return L}});var r=n(5236);n(9675);var c=n(5735),o=n(516),i=n(9842);let a=(0,r.ZF)({apiKey:"AIzaSyD9IyIValBX6xooTZ3wsBPfKsyYvNwAWik",authDomain:"dichchuhan-55a4d.firebaseapp.com",databaseURL:"https://dichchuhan-55a4d-default-rtdb.firebaseio.com",projectId:"dichchuhan-55a4d",storageBucket:"dichchuhan-55a4d.appspot.com",messagingSenderId:"589658521880",appId:"1:589658521880:web:65694d6b4f17f4ca6b1e6d",measurementId:"G-G02KSBMR52"}),l=(0,o.N8)(a);function s(){var e=document.getElementById("fileList").value,t=document.querySelector(".content-right").value,n={[e]:t},r="/users/user1/kecheng/".concat(e),c="/users/user1/contents/".concat(e),i=(0,o.iH)(l,c);(0,o.t8)(i,n).then(()=>{console.log("Dữ liệu b\xe0i dịch đ\xe3 được ghi th\xe0nh c\xf4ng l\xean Firebase.")}).catch(e=>{console.error("Lỗi khi ghi dữ liệu b\xe0i dịch:",e)}),i=(0,o.iH)(l,r),n={[e]:t=document.querySelector(".content-left").value},(0,o.t8)(i,n).then(()=>{console.log("Dữ liệu kecheng đ\xe3 được ghi th\xe0nh c\xf4ng l\xean Firebase.")}).catch(e=>{console.error("Lỗi khi ghi dữ liệu kecheng:",e)})}function u(e){var t={[e]:"".concat(e," phần dịch")},n="/users/user1/kecheng/".concat(e),r="/users/user1/contents/".concat(e),c=(0,o.iH)(l,r);(0,o.t8)(c,t).then(()=>{console.log("Dữ liệu b\xe0i dịch đ\xe3 được ghi th\xe0nh c\xf4ng l\xean Firebase.")}).catch(e=>{console.error("Lỗi khi ghi dữ liệu b\xe0i dịch:",e)}),c=(0,o.iH)(l,n),t={[e]:"".concat(e," 中文")},(0,o.t8)(c,t).then(()=>{console.log("Dữ liệu kecheng đ\xe3 được ghi th\xe0nh c\xf4ng l\xean Firebase.")}).catch(e=>{console.error("Lỗi khi ghi dữ liệu kecheng:",e)})}async function h(e,t){var n=(0,o.iH)(l,e);try{return await (0,o.t8)(n,t),!0}catch(e){throw console.error("C\xf3 lỗi xảy ra:",e),e}}function d(e){var t=(0,o.iH)(l,"/users/user1/contents/".concat(e));(0,o.Od)(t).then(()=>{console.log("Dữ liệu b\xe0i dịch đ\xe3 được x\xf3a th\xe0nh c\xf4ng từ Firebase.")}).catch(e=>{console.error("Lỗi khi x\xf3a dữ liệu b\xe0i dịch:",e)}),t=(0,o.iH)(l,"/users/user1/kecheng/".concat(e)),(0,o.Od)(t).then(()=>{console.log("Dữ liệu kecheng đ\xe3 được x\xf3a th\xe0nh c\xf4ng từ Firebase.")}).catch(e=>{console.error("Lỗi khi x\xf3a dữ liệu kecheng:",e)})}async function g(e){var t=(0,o.iH)(l,e);try{return await (0,o.Od)(t),!0}catch(e){throw console.error("C\xf3 lỗi xảy ra:",e),e}}function f(){var e=document.getElementById("fileList").value,t="/users/user1/kecheng/".concat(e,"/").concat(e),n="/users/user1/contents/".concat(e,"/").concat(e);console.log(t),console.log(m(n)),m(n).then(e=>{null!==e&&(document.querySelector(".content-right").value=e)}).catch(e=>{console.error("C\xf3 lỗi xảy ra:",e)}),m(t).then(e=>{null!==e&&(document.querySelector(".content-left").value=e)}).catch(e=>{console.error("C\xf3 lỗi xảy ra:",e)})}function m(e){return new Promise((t,n)=>{var r=(0,o.iH)(l,e);(0,o.U2)(r).then(e=>{e.exists()?t(e.val()):(console.log("Kh\xf4ng c\xf3 dữ liệu tại đường dẫn n\xe0y."),t(null))}).catch(e=>{console.error("Lỗi khi đọc dữ liệu:",e),n(e)})})}async function w(e){var t=(0,o.iH)(l,e);try{var n=await (0,o.U2)(t);if(n.exists())return n.val();return null}catch(e){return console.error("Lỗi khi đọc dữ liệu:",e),null}}function S(e){return new Promise((t,n)=>{var r=(0,o.iH)(l,e);(0,o.U2)(r).then(e=>{e.exists()?t(Object.entries(e.val()).map(e=>{let[t,n]=e;return{key:t,value:n}})):t(null)}).catch(e=>{console.error("Lỗi khi đọc dữ liệu:",e),n(e)})})}(0,i.ad)(a);let y="users/user1/contents";async function v(){let e=(0,o.iH)(l,y),t=await (0,o.U2)(e);t.exists()?(b(Object.keys(t.val())),f()):console.log("Kh\xf4ng c\xf3 dữ liệu tại đường dẫn n\xe0y.")}async function p(e){let t=(0,o.iH)(l,y),n=await (0,o.U2)(t);if(n.exists()){var r,c;b(Object.keys(n.val())),r="/users/user1/kecheng/".concat(e,"/").concat(e),c="/users/user1/contents/".concat(e,"/").concat(e),document.getElementById("fileList").value=e,m(c).then(e=>{null!==e&&(document.querySelector(".content-right").value=e)}).catch(e=>{console.error("C\xf3 lỗi xảy ra:",e)}),m(r).then(e=>{null!==e&&(document.querySelector(".content-left").value=e)}).catch(e=>{console.error("C\xf3 lỗi xảy ra:",e)})}else console.log("Kh\xf4ng c\xf3 dữ liệu tại đường dẫn n\xe0y.")}function b(e){let t=document.getElementById("fileList");for(;t.firstChild;)t.removeChild(t.firstChild);e.forEach(e=>{let n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)})}let x=(0,c.v0)(a);async function k(){let e=new c.hJ;try{return await (0,c.rh)(x,e)}catch(e){throw console.error("Lỗi đăng nhập:",e),e}}new c.hJ;let D=async()=>{if(!x.currentUser){console.warn("No user currently signed in.");return}try{await (0,c.w7)(x),console.log("User signed out")}catch(e){console.error("Logout failed:",e)}},L=async e=>{let t=new Date().toISOString().slice(0,10),n=(0,o.iH)(l,"user/activityLogs/".concat(e,"/").concat(t)),r=(0,o.iH)(l,"user/status/".concat(e));(await (0,o.U2)(n)).exists()?await (0,o.Vx)(n,{currentSessionStart:new Date().toISOString()}):await (0,o.t8)(n,{currentSessionStart:new Date().toISOString(),totalSeconds:0}),console.log("markUserOnline"),await (0,o.t8)(r,{isOnline:!0,timestamp:new Date().toISOString()}),(0,o.ae)(r).set({isOnline:!1,timestamp:new Date().toISOString()})},I=async e=>{let t=new Date().toISOString().slice(0,10),n=(0,o.iH)(l,"user/activityLogs/".concat(e,"/").concat(t)),r=(0,o.iH)(l,"user/status/".concat(e)),c=await (0,o.U2)(n);if(c.exists()){let e=c.val(),t=new Date(e.currentSessionStart),r=new Date;if(isNaN(t.getTime())){console.warn("⚠️ currentSessionStart kh\xf4ng hợp lệ:",e.currentSessionStart);return}let i=Math.floor((r-t)/1e3),a="number"==typeof e.totalSeconds?e.totalSeconds:0;if(isNaN(i)||isNaN(a)){console.warn("⚠️ Gi\xe1 trị thời gian kh\xf4ng hợp lệ:",{sessionSeconds:i,previousTotal:a});return}await (0,o.Vx)(n,{endTime:r.toISOString(),totalSeconds:a+i,currentSessionStart:null})}await (0,o.t8)(r,{isOnline:!1,timestamp:new Date().toISOString()})}}}]);