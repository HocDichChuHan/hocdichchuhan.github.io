"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6223],{16223:function(t,e,i){i.r(e);let r="undefined"==typeof window?i.g:window,s=r.performance&&(()=>r.performance.now())||(()=>Date.now()),o=(null===(t$=r.requestAnimationFrame)||void 0===t$?void 0:t$.bind(r))||(t=>setTimeout(()=>t(s()),1e3/60)),n=(null===(tR=r.cancelAnimationFrame)||void 0===tR?void 0:tR.bind(r))||clearTimeout;function a(t){return t[t.length-1]}let h=(t,e)=>t<0?e+t:t,l=(t,e)=>t[h(e,t.length)],u=0;function d(t){return t.reduce((t,e)=>e+t,0)/t.length}function c(t){let e=t.toUpperCase().trim();if(/^#([A-F0-9]{3}){1,2}$/.test(e)){let t=e.substring(1).split("");3===t.length&&(t=[t[0],t[0],t[1],t[1],t[2],t[2]]);let i=`${t.join("")}`;return{r:parseInt(i.slice(0,2),16),g:parseInt(i.slice(2,4),16),b:parseInt(i.slice(4,6),16),a:1}}let i=e.match(/^RGBA?\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d*\.?\d+))?\)$/);if(i)return{r:parseInt(i[1],10),g:parseInt(i[2],10),b:parseInt(i[3],10),a:parseFloat(i[4]||1,10)};throw Error(`Invalid color: ${t}`)}let _=t=>t.replace(/^\s+/,"").replace(/\s+$/,"");function p(t,e){let i={};for(let r=0;r<e;r++)i[r]=t;return i}let g=(null===(tA=r.navigator)||void 0===tA?void 0:tA.userAgent)||"",k=g.indexOf("MSIE ")>0||g.indexOf("Trident/")>0||g.indexOf("Edge/")>0,m=()=>{};class f{constructor(t,e,i=m){this._mutationChains=[],this._onStateChange=i,this.state={options:{drawingFadeDuration:e.drawingFadeDuration,drawingWidth:e.drawingWidth,drawingColor:c(e.drawingColor),strokeColor:c(e.strokeColor),outlineColor:c(e.outlineColor),radicalColor:c(e.radicalColor||e.strokeColor),highlightColor:c(e.highlightColor)},character:{main:{opacity:e.showCharacter?1:0,strokes:{}},outline:{opacity:e.showOutline?1:0,strokes:{}},highlight:{opacity:1,strokes:{}}},userStrokes:null};for(let e=0;e<t.strokes.length;e++)this.state.character.main.strokes[e]={opacity:1,displayPortion:1},this.state.character.outline.strokes[e]={opacity:1,displayPortion:1},this.state.character.highlight.strokes[e]={opacity:0,displayPortion:1}}overwriteOnStateChange(t){this._onStateChange=t}updateState(t){let e=function t(e,i){let r={...e};for(let s in i){let o=e[s],n=i[s];o!==n&&(o&&n&&"object"==typeof o&&"object"==typeof n&&!Array.isArray(n)?r[s]=t(o,n):r[s]=n)}return r}(this.state,t);this._onStateChange(e,this.state),this.state=e}run(t,e={}){let i=t.map(t=>t.scope);return this.cancelMutations(i),new Promise(r=>{let s={_isActive:!0,_index:0,_resolve:r,_mutations:t,_loop:e.loop,_scopes:i};this._mutationChains.push(s),this._run(s)})}_run(t){if(!t._isActive)return;let e=t._mutations;if(t._index>=e.length){if(t._loop)t._index=0;else{t._isActive=!1,this._mutationChains=this._mutationChains.filter(e=>e!==t),t._resolve({canceled:!1});return}}t._mutations[t._index].run(this).then(()=>{t._isActive&&(t._index++,this._run(t))})}_getActiveMutations(){return this._mutationChains.map(t=>t._mutations[t._index])}pauseAll(){this._getActiveMutations().forEach(t=>t.pause())}resumeAll(){this._getActiveMutations().forEach(t=>t.resume())}cancelMutations(t){for(let e of this._mutationChains)for(let i of e._scopes)for(let r of t)(i.startsWith(r)||r.startsWith(i))&&this._cancelMutationChain(e)}cancelAll(){this.cancelMutations([""])}_cancelMutationChain(t){var e;t._isActive=!1;for(let e=t._index;e<t._mutations.length;e++)t._mutations[e].cancel(this);null===(e=t._resolve)||void 0===e||e.call(t,{canceled:!0}),this._mutationChains=this._mutationChains.filter(e=>e!==t)}}let v=(t,e)=>({x:t.x-e.x,y:t.y-e.y}),y=t=>Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)),S=(t,e)=>y(v(t,e)),w=(t,e)=>t.x===e.x&&t.y===e.y,C=(t,e=1)=>{let i=10*e;return{x:Math.round(i*t.x)/i,y:Math.round(i*t.y)/i}},P=t=>{let e=t[0];return t.slice(1).reduce((t,i)=>{let r=S(i,e);return e=i,t+r},0)},x=(t,e)=>(t.x*e.x+t.y*e.y)/y(t)/y(e),D=(t,e,i)=>{let r=v(e,t),s=i/y(r);return{x:e.x+s*r.x,y:e.y+s*r.y}},M=(t,e)=>{let i=t.length>=e.length?t:e,r=t.length>=e.length?e:t,s=(t,e,s,o)=>{if(0===t&&0===e)return S(i[0],r[0]);if(t>0&&0===e)return Math.max(s[0],S(i[t],r[0]));let n=o[o.length-1];return 0===t&&e>0?Math.max(n,S(i[0],r[e])):Math.max(Math.min(s[e],s[e-1],n),S(i[t],r[e]))},o=[];for(let t=0;t<i.length;t++){let e=[];for(let i=0;i<r.length;i++)e.push(s(t,i,o,e));o=e}return o[r.length-1]},T=(t,e=.05)=>{let i=t.slice(0,1);for(let r of t.slice(1)){let t=i[i.length-1],s=S(r,t);if(s>e){let o=Math.ceil(s/e),n=s/o;for(let e=0;e<o;e++)i.push(D(r,t,-1*n*(e+1)))}else i.push(r)}return i},$=(t,e=30)=>{let i=P(t)/(e-1),r=[t[0]],s=a(t),o=t.slice(1);for(let t=0;t<e-2;t++){let t=a(r),e=i,s=!1;for(;!s;){let i=S(t,o[0]);if(i<e)e-=i,t=o.shift();else{let n=D(t,o[0],e-i);r.push(n),s=!0}}}return r.push(s),r},R=t=>{let e=$(t),i={x:d(e.map(t=>t.x)),y:d(e.map(t=>t.y))},r=e.map(t=>v(t,i)),s=Math.sqrt(d([Math.pow(r[0].x,2)+Math.pow(r[0].y,2),Math.pow(a(r).x,2)+Math.pow(a(r).y,2)]));return T(r.map(t=>({x:t.x/s,y:t.y/s})))},A=(t,e)=>t.map(t=>({x:Math.cos(e)*t.x-Math.sin(e)*t.y,y:Math.sin(e)*t.x+Math.cos(e)*t.y})),L=t=>{if(t.length<3)return t;let e=[t[0],t[1]];return t.slice(2).forEach(t=>{let i=e.length,r=v(t,e[i-1]),s=v(e[i-1],e[i-2]);r.y*s.x-r.x*s.y==0&&e.pop(),e.push(t)}),e};function O(t,e=!1){let i=C(t[0]),r=t.slice(1),s=`M ${i.x} ${i.y}`;return r.forEach(t=>{let e=C(t);s+=` L ${e.x} ${e.y}`}),e&&(s+="Z"),s}let b=(t,e)=>{let i=L(t);if(i.length<2)return i;let r=D(i[1],i[0],e),s=i.slice(1);return s.unshift(r),s};class E{constructor(t,e,i,r=!1){this.path=t,this.points=e,this.strokeNum=i,this.isInRadical=r}getStartingPoint(){return this.points[0]}getEndingPoint(){return this.points[this.points.length-1]}getLength(){return P(this.points)}getVectors(){let t=this.points[0];return this.points.slice(1).map(e=>{let i=v(e,t);return t=e,i})}getDistance(t){return Math.min(...this.points.map(e=>S(e,t)))}getAverageDistance(t){return t.reduce((t,e)=>t+this.getDistance(e),0)/t.length}}class z{constructor(t,e){this.symbol=t,this.strokes=e}}let[I,F]=[{x:0,y:-124},{x:1024,y:900}],W=F.x-I.x,H=F.y-I.y;class q{constructor(t){let{padding:e,width:i,height:r}=t;this.padding=e,this.width=i,this.height=r;let s=i-2*e,o=r-2*e;this.scale=Math.min(s/W,o/H);let n=e+(s-this.scale*W)/2,a=e+(o-this.scale*H)/2;this.xOffset=-1*I.x*this.scale+n,this.yOffset=-1*I.y*this.scale+a}convertExternalPoint(t){return{x:(t.x-this.xOffset)/this.scale,y:(this.height-this.yOffset-t.y)/this.scale}}}let B=(t,e,i)=>{let r=S(e.getStartingPoint(),t[0]),s=S(e.getEndingPoint(),t[t.length-1]);return r<=250*i&&s<=250*i},N=t=>{let e=[],i=t[0];return t.slice(1).forEach(t=>{e.push(v(t,i)),i=t}),e},j=(t,e)=>{let i=N(t),r=e.getVectors();return d(i.map(t=>Math.max(...r.map(e=>x(e,t)))))>0},U=(t,e,i)=>i*(P(t)+25)/(e.getLength()+25)>=.35,Q=t=>{if(t.length<2)return t;let[e,...i]=t,r=[e];for(let t of i)w(t,r[r.length-1])||r.push(t);return r},V=[Math.PI/16,Math.PI/32,0,-1*Math.PI/32,-1*Math.PI/16],G=(t,e,i)=>{let r=R(t),s=R(e),o=1/0;return V.forEach(t=>{let e=M(r,A(s,t));e<o&&(o=e)}),o<=.4*i},X=(t,e,i)=>{let{leniency:r=1,isOutlineVisible:s=!1,checkBackwards:o=!0,averageDistanceThreshold:n=350}=i,a=e.getAverageDistance(t),h=a<=n*(s||e.strokeNum>0?.5:1)*r;if(!h)return{isMatch:!1,avgDist:a,meta:{isStrokeBackwards:!1}};let l=B(t,e,r),u=j(t,e),d=G(t,e.points,r),c=U(t,e,r),_=h&&l&&u&&d&&c;return o&&!_&&X([...t].reverse(),e,{...i,checkBackwards:!1}).isMatch?{isMatch:_,avgDist:a,meta:{isStrokeBackwards:!0}}:{isMatch:_,avgDist:a,meta:{isStrokeBackwards:!1}}};class K{constructor(t,e,i){this.id=t,this.points=[e],this.externalPoints=[i]}appendPoint(t,e){this.points.push(t),this.externalPoints.push(e)}}class Y{constructor(t){this._duration=t,this._startTime=null,this._paused=!1,this.scope=`delay.${t}`}run(){return this._startTime=s(),this._runningPromise=new Promise(t=>{this._resolve=t,this._timeout=setTimeout(()=>this.cancel(),this._duration)}),this._runningPromise}pause(){if(this._paused)return;let t=performance.now()-(this._startTime||0);this._duration=Math.max(0,this._duration-t),clearTimeout(this._timeout),this._paused=!0}resume(){this._paused&&(this._startTime=performance.now(),this._timeout=setTimeout(()=>this.cancel(),this._duration),this._paused=!1)}cancel(){clearTimeout(this._timeout),this._resolve&&this._resolve(),this._resolve=void 0}}class J{constructor(t,e,i={}){this._tick=t=>{if(null!==this._startPauseTime)return;let e=Math.min(1,(t-this._startTime-this._pausedDuration)/this._duration);if(1===e)this._renderState.updateState(this._values),this._frameHandle=void 0,this.cancel(this._renderState);else{let t=Z(e),i=function t(e,i,r){let s={};for(let o in i){let n=i[o],a=null==e?void 0:e[o];"number"==typeof a&&"number"==typeof n&&n>=0?s[o]=r*(n-a)+a:s[o]=t(a,n,r)}return s}(this._startState,this._values,t);this._renderState.updateState(i),this._frameHandle=o(this._tick)}},this.scope=t,this._valuesOrCallable=e,this._duration=i.duration||0,this._force=i.force,this._pausedDuration=0,this._startPauseTime=null}run(t){return(this._values||this._inflateValues(t),0===this._duration&&t.updateState(this._values),0===this._duration||function t(e,i){for(let r in i){let s=i[r],o=null==e?void 0:e[r];if(s>=0){if(s!==o)return!1}else if(!t(o,s))return!1}return!0}(t.state,this._values))?Promise.resolve():(this._renderState=t,this._startState=t.state,this._startTime=performance.now(),this._frameHandle=o(this._tick),new Promise(t=>{this._resolve=t}))}_inflateValues(t){let e=this._valuesOrCallable;"function"==typeof this._valuesOrCallable&&(e=this._valuesOrCallable(t.state)),this._values=function(t,e){let i=t.split("."),r={},s=r;for(let t=0;t<i.length;t++){let r=t===i.length-1?e:{};s[i[t]]=r,s=r}return r}(this.scope,e)}pause(){null===this._startPauseTime&&(this._frameHandle&&n(this._frameHandle),this._startPauseTime=performance.now())}resume(){null!==this._startPauseTime&&(this._frameHandle=o(this._tick),this._pausedDuration+=performance.now()-this._startPauseTime,this._startPauseTime=null)}cancel(t){var e;null===(e=this._resolve)||void 0===e||e.call(this),this._resolve=void 0,n(this._frameHandle||-1),this._frameHandle=void 0,this._force&&(this._values||this._inflateValues(t),t.updateState(this._values))}}J.Delay=Y;let Z=t=>-Math.cos(t*Math.PI)/2+.5,tt=(t,e,i)=>[new J(`character.${t}.strokes`,p({opacity:1,displayPortion:1},e.strokes.length),{duration:i,force:!0})],te=(t,e,i)=>[new J(`character.${t}`,{opacity:1,strokes:p({opacity:1,displayPortion:1},e.strokes.length)},{duration:i,force:!0})],ti=(t,e,i)=>[new J(`character.${t}.opacity`,0,{duration:i,force:!0}),...tt(t,e,0)],tr=(t,e,i)=>[new J(`options.${t}`,e,{duration:i})],ts=(t,e,i)=>{let r=t.strokeNum,s=(t.getLength()+600)/(3*i);return[new J("options.highlightColor",e),new J("character.highlight",{opacity:1,strokes:{[r]:{displayPortion:0,opacity:0}}}),new J(`character.highlight.strokes.${r}`,{displayPortion:1,opacity:1},{duration:s}),new J(`character.highlight.strokes.${r}.opacity`,0,{duration:s,force:!0})]},to=(t,e,i)=>{let r=e.strokeNum,s=(e.getLength()+600)/(3*i);return[new J(`character.${t}`,{opacity:1,strokes:{[r]:{displayPortion:0,opacity:1}}}),new J(`character.${t}.strokes.${r}.displayPortion`,1,{duration:s})]},tn=(t,e,i,r)=>{let s=e.strokes[i];return[new J(`character.${t}`,i=>{let r=i.character[t],s={opacity:1,strokes:{}};for(let t=0;t<e.strokes.length;t++)s.strokes[t]={opacity:r.opacity*r.strokes[t].opacity};return s}),...to(t,s,r)]},ta=(t,e,i)=>[new J(`character.${t}.strokes.${e}`,{displayPortion:1,opacity:1},{duration:i,force:!0})],th=(t,e,i,r,s)=>{let o=ti(t,e,i);return(o=o.concat(tt(t,e,0))).push(new J(`character.${t}`,{opacity:1,strokes:p({opacity:0},e.strokes.length)},{force:!0})),e.strokes.forEach((e,i)=>{i>0&&o.push(new J.Delay(s)),o=o.concat(to(t,e,r))}),o},tl=(t,e,i,r,s,o)=>{let n=th(t,e,i,r,s);return n.push(new J.Delay(o)),n},tu=(t,e,i)=>[...ti("main",t,e),new J("character.highlight",{opacity:1,strokes:p({opacity:0},t.strokes.length)},{force:!0}),new J("character.main",{opacity:1,strokes:function(t,e){let i={};for(let r=0;r<t;r++)i[r]=e(r);return i}(t.strokes.length,t=>({opacity:t<i?1:0}))},{force:!0})],td=(t,e)=>[new J("quiz.activeUserStrokeId",t,{force:!0}),new J(`userStrokes.${t}`,{points:[e],opacity:1},{force:!0})],tc=(t,e)=>[new J(`userStrokes.${t}.points`,e,{force:!0})],t_=(t,e)=>[new J(`userStrokes.${t}.opacity`,0,{duration:e})],tp=t=>(null==t?void 0:t.map(t=>new J(`userStrokes.${t}`,null,{force:!0})))||[],tg=(t,e,i)=>[new J("options.highlightColor",e),...ti("highlight",t),...te("highlight",t,i/2),...ti("highlight",t,i/2)],tk=t=>({pathString:O(t.externalPoints),points:t.points.map(t=>C(t))});class tm{constructor(t,e,i){this._currentStrokeIndex=0,this._mistakesOnStroke=0,this._totalMistakes=0,this._character=t,this._renderState=e,this._isActive=!1,this._positioner=i}startQuiz(t){this._userStrokesIds&&this._renderState.run(tp(this._userStrokesIds)),this._userStrokesIds=[],this._isActive=!0,this._options=t;let e=h(t.quizStartStrokeNum,this._character.strokes.length);return this._currentStrokeIndex=Math.min(e,this._character.strokes.length-1),this._mistakesOnStroke=0,this._totalMistakes=0,this._renderState.run(tu(this._character,t.strokeFadeDuration,this._currentStrokeIndex))}startUserStroke(t){var e;if(!this._isActive)return null;if(this._userStroke)return this.endUserStroke();let i=this._positioner.convertExternalPoint(t),r=++u;return this._userStroke=new K(r,i,t),null===(e=this._userStrokesIds)||void 0===e||e.push(r),this._renderState.run(td(r,i))}continueUserStroke(t){if(!this._userStroke)return Promise.resolve();let e=this._positioner.convertExternalPoint(t);this._userStroke.appendPoint(e,t);let i=this._userStroke.points.slice(0);return this._renderState.run(tc(this._userStroke.id,i))}setPositioner(t){this._positioner=t}endUserStroke(){var t;if(!this._userStroke)return;if(this._renderState.run(t_(this._userStroke.id,null!==(t=this._options.drawingFadeDuration)&&void 0!==t?t:300)),1===this._userStroke.points.length){this._userStroke=void 0;return}let{acceptBackwardsStrokes:e,markStrokeCorrectAfterMisses:i}=this._options,r=this._getCurrentStroke(),{isMatch:s,meta:o}=function(t,e,i,r={}){let s=e.strokes,o=Q(t.points);if(o.length<2)return{isMatch:!1,meta:{isStrokeBackwards:!1}};let{isMatch:n,meta:a,avgDist:h}=X(o,s[i],r);if(!n)return{isMatch:n,meta:a};let l=s.slice(i+1),u=h;for(let t=0;t<l.length;t++){let{isMatch:e,avgDist:i}=X(o,l[t],{...r,checkBackwards:!1});e&&i<u&&(u=i)}if(u<h){let t=.6*(u+h)/(2*h),{isMatch:e,meta:n}=X(o,s[i],{...r,leniency:(r.leniency||1)*t});return{isMatch:e,meta:n}}return{isMatch:n,meta:a}}(this._userStroke,this._character,this._currentStrokeIndex,{isOutlineVisible:this._renderState.state.character.outline.opacity>0,leniency:this._options.leniency,averageDistanceThreshold:this._options.averageDistanceThreshold}),n=i&&this._mistakesOnStroke+1>=i;if(s||n||o.isStrokeBackwards&&e)this._handleSuccess(o);else{this._handleFailure(o);let{showHintAfterMisses:t,highlightColor:e,strokeHighlightSpeed:i}=this._options;!1!==t&&this._mistakesOnStroke>=t&&this._renderState.run(ts(r,c(e),i))}this._userStroke=void 0}cancel(){this._isActive=!1,this._userStrokesIds&&this._renderState.run(tp(this._userStrokesIds))}_getStrokeData({isCorrect:t,meta:e}){return{character:this._character.symbol,strokeNum:this._currentStrokeIndex,mistakesOnStroke:this._mistakesOnStroke,totalMistakes:this._totalMistakes,strokesRemaining:this._character.strokes.length-this._currentStrokeIndex-(t?1:0),drawnPath:tk(this._userStroke),isBackwards:e.isStrokeBackwards}}nextStroke(){if(!this._options)return;let{strokes:t,symbol:e}=this._character,{onComplete:i,highlightOnComplete:r,strokeFadeDuration:s,highlightCompleteColor:o,highlightColor:n,strokeHighlightDuration:a}=this._options,h=ta("main",this._currentStrokeIndex,s);this._mistakesOnStroke=0,this._currentStrokeIndex+=1,this._currentStrokeIndex===t.length&&(this._isActive=!1,null==i||i({character:e,totalMistakes:this._totalMistakes}),r&&(h=h.concat(tg(this._character,c(o||n),2*(a||0))))),this._renderState.run(h)}_handleSuccess(t){if(!this._options)return;let{onCorrectStroke:e}=this._options;null==e||e({...this._getStrokeData({isCorrect:!0,meta:t})}),this.nextStroke()}_handleFailure(t){var e,i;this._mistakesOnStroke+=1,this._totalMistakes+=1,null===(e=(i=this._options).onMistake)||void 0===e||e.call(i,this._getStrokeData({isCorrect:!1,meta:t}))}_getCurrentStroke(){return this._character.strokes[this._currentStrokeIndex]}}function tf(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function tv(t,e,i){t.setAttributeNS(null,e,i)}function ty(t,e){Object.keys(e).forEach(i=>tv(t,i,e[i]))}function tS(t){var e;null==t||null===(e=t.parentNode)||void 0===e||e.removeChild(t)}class tw{constructor(t){this.stroke=t,this._pathLength=t.getLength()+tw.STROKE_WIDTH/2}_getStrokeDashoffset(t){return .999*this._pathLength*(1-t)}_getColor({strokeColor:t,radicalColor:e}){return e&&this.stroke.isInRadical?e:t}}tw.STROKE_WIDTH=200;class tC extends tw{constructor(t){super(t),this._oldProps=void 0}mount(t){let e;this._animationPath=tf("path"),this._clip=tf("clipPath"),this._strokePath=tf("path");let i=`mask-${++u}`;tv(this._clip,"id",i),tv(this._strokePath,"d",this.stroke.path),this._animationPath.style.opacity="0",tv(this._animationPath,"clip-path",(e="",window.location&&window.location.href&&(e=window.location.href.replace(/#[^#]*$/,"").replace(/"/gi,"%22")),`url("${e}#${i}")`));let r=b(this.stroke.points,100);return tv(this._animationPath,"d",O(r)),ty(this._animationPath,{stroke:"#FFFFFF","stroke-width":"200",fill:"none","stroke-linecap":"round","stroke-linejoin":"miter","stroke-dasharray":`${this._pathLength},${this._pathLength}`}),this._clip.appendChild(this._strokePath),t.defs.appendChild(this._clip),t.svg.appendChild(this._animationPath),this}render(t){var e,i;if(t===this._oldProps||!this._animationPath)return;t.displayPortion!==(null===(e=this._oldProps)||void 0===e?void 0:e.displayPortion)&&(this._animationPath.style.strokeDashoffset=this._getStrokeDashoffset(t.displayPortion).toString());let r=this._getColor(t);if(!this._oldProps||r!==this._getColor(this._oldProps)){let{r:t,g:e,b:i,a:s}=r;ty(this._animationPath,{stroke:`rgba(${t},${e},${i},${s})`})}t.opacity!==(null===(i=this._oldProps)||void 0===i?void 0:i.opacity)&&(this._animationPath.style.opacity=t.opacity.toString()),this._oldProps=t}}class tP{constructor(t){this._oldProps=void 0,this._strokeRenderers=t.strokes.map(t=>new tC(t))}mount(t){let e=t.createSubRenderTarget();this._group=e.svg,this._strokeRenderers.forEach(t=>{t.mount(e)})}render(t){var e,i,r,s;if(t===this._oldProps||!this._group)return;let{opacity:o,strokes:n,strokeColor:a,radicalColor:h=null}=t;o===(null===(e=this._oldProps)||void 0===e?void 0:e.opacity)||(this._group.style.opacity=o.toString(),k||(0===o?this._group.style.display="none":(null===(r=this._oldProps)||void 0===r?void 0:r.opacity)===0&&this._group.style.removeProperty("display")));let l=!this._oldProps||a!==this._oldProps.strokeColor||h!==this._oldProps.radicalColor;if(l||n!==(null===(i=this._oldProps)||void 0===i?void 0:i.strokes))for(let t=0;t<this._strokeRenderers.length;t++)(l||null===(s=this._oldProps)||void 0===s||!s.strokes||n[t]!==this._oldProps.strokes[t])&&this._strokeRenderers[t].render({strokeColor:a,radicalColor:h,opacity:n[t].opacity,displayPortion:n[t].displayPortion});this._oldProps=t}}class tx{constructor(){this._oldProps=void 0}mount(t){this._path=tf("path"),t.svg.appendChild(this._path)}render(t){var e,i,r,s;if(this._path&&t!==this._oldProps){if(t.strokeColor!==(null===(e=this._oldProps)||void 0===e?void 0:e.strokeColor)||t.strokeWidth!==(null===(i=this._oldProps)||void 0===i?void 0:i.strokeWidth)){let{r:e,g:i,b:r,a:s}=t.strokeColor;ty(this._path,{fill:"none",stroke:`rgba(${e},${i},${r},${s})`,"stroke-width":t.strokeWidth.toString(),"stroke-linecap":"round","stroke-linejoin":"round"})}t.opacity!==(null===(r=this._oldProps)||void 0===r?void 0:r.opacity)&&tv(this._path,"opacity",t.opacity.toString()),t.points!==(null===(s=this._oldProps)||void 0===s?void 0:s.points)&&tv(this._path,"d",O(t.points)),this._oldProps=t}}destroy(){tS(this._path)}}class tD{constructor(t,e){this._character=t,this._positioner=e,this._mainCharRenderer=new tP(t),this._outlineCharRenderer=new tP(t),this._highlightCharRenderer=new tP(t),this._userStrokeRenderers={}}mount(t){let e=t.createSubRenderTarget(),i=e.svg,{xOffset:r,yOffset:s,height:o,scale:n}=this._positioner;tv(i,"transform",`translate(${r}, ${o-s}) scale(${n}, ${-1*n})`),this._outlineCharRenderer.mount(e),this._mainCharRenderer.mount(e),this._highlightCharRenderer.mount(e),this._positionedTarget=e}render(t){let{main:e,outline:i,highlight:r}=t.character,{outlineColor:s,radicalColor:o,highlightColor:n,strokeColor:a,drawingWidth:h,drawingColor:l}=t.options;this._outlineCharRenderer.render({opacity:i.opacity,strokes:i.strokes,strokeColor:s}),this._mainCharRenderer.render({opacity:e.opacity,strokes:e.strokes,strokeColor:a,radicalColor:o}),this._highlightCharRenderer.render({opacity:r.opacity,strokes:r.strokes,strokeColor:n});let u=t.userStrokes||{};for(let t in this._userStrokeRenderers)if(!u[t]){var d;null===(d=this._userStrokeRenderers[t])||void 0===d||d.destroy(),delete this._userStrokeRenderers[t]}for(let t in u){let e=u[t];if(!e)continue;let i={strokeWidth:h,strokeColor:l,...e};(()=>{if(this._userStrokeRenderers[t])return this._userStrokeRenderers[t];let e=new tx;return e.mount(this._positionedTarget),this._userStrokeRenderers[t]=e,e})().render(i)}}destroy(){tS(this._positionedTarget.svg),this._positionedTarget.defs.innerHTML=""}}class tM{constructor(t){this.node=t}addPointerStartListener(t){this.node.addEventListener("mousedown",e=>{t(this._eventify(e,this._getMousePoint))}),this.node.addEventListener("touchstart",e=>{t(this._eventify(e,this._getTouchPoint))})}addPointerMoveListener(t){this.node.addEventListener("mousemove",e=>{t(this._eventify(e,this._getMousePoint))}),this.node.addEventListener("touchmove",e=>{t(this._eventify(e,this._getTouchPoint))})}addPointerEndListener(t){document.addEventListener("mouseup",t),document.addEventListener("touchend",t)}getBoundingClientRect(){return this.node.getBoundingClientRect()}updateDimensions(t,e){this.node.setAttribute("width",`${t}`),this.node.setAttribute("height",`${e}`)}_eventify(t,e){return{getPoint:()=>e.call(this,t),preventDefault:()=>t.preventDefault()}}_getMousePoint(t){let{left:e,top:i}=this.getBoundingClientRect();return{x:t.clientX-e,y:t.clientY-i}}_getTouchPoint(t){let{left:e,top:i}=this.getBoundingClientRect();return{x:t.touches[0].clientX-e,y:t.touches[0].clientY-i}}}class tT extends tM{constructor(t,e){super(t),this.svg=t,this.defs=e,"createSVGPoint"in t&&(this._pt=t.createSVGPoint())}static init(t,e="100%",i="100%"){let r="string"==typeof t?document.getElementById(t):t;if(!r)throw Error(`HanziWriter target element not found: ${t}`);let s=r.nodeName.toUpperCase(),o=(()=>{if("SVG"===s||"G"===s)return r;{let t=tf("svg");return r.appendChild(t),t}})();ty(o,{width:e,height:i});let n=tf("defs");return o.appendChild(n),new tT(o,n)}createSubRenderTarget(){let t=tf("g");return this.svg.appendChild(t),new tT(t,this.defs)}_getMousePoint(t){if(this._pt&&(this._pt.x=t.clientX,this._pt.y=t.clientY,"getScreenCTM"in this.node)){var e;let t=this._pt.matrixTransform(null===(e=this.node.getScreenCTM())||void 0===e?void 0:e.inverse());return{x:t.x,y:t.y}}return super._getMousePoint.call(this,t)}_getTouchPoint(t){if(this._pt&&(this._pt.x=t.touches[0].clientX,this._pt.y=t.touches[0].clientY,"getScreenCTM"in this.node)){var e;let t=this._pt.matrixTransform(null===(e=this.node.getScreenCTM())||void 0===e?void 0:e.inverse());return{x:t.x,y:t.y}}return super._getTouchPoint(t)}}var t$,tR,tA,tL={HanziWriterRenderer:tD,createRenderTarget:tT.init};let tO=(t,e)=>{t.beginPath();let i=e[0],r=e.slice(1);for(let e of(t.moveTo(i.x,i.y),r))t.lineTo(e.x,e.y);t.stroke()},tb=t=>{let e=t.split(/(^|\s+)(?=[A-Z])/).filter(t=>" "!==t),i=[t=>t.beginPath()];for(let t of e){let[e,...r]=t.split(/\s+/),s=r.map(t=>parseFloat(t));"M"===e?i.push(t=>t.moveTo(...s)):"L"===e?i.push(t=>t.lineTo(...s)):"C"===e?i.push(t=>t.bezierCurveTo(...s)):"Q"===e&&i.push(t=>t.quadraticCurveTo(...s))}return t=>i.forEach(e=>e(t))};class tE extends tw{constructor(t,e=!0){super(t),e&&Path2D?this._path2D=new Path2D(this.stroke.path):this._pathCmd=tb(this.stroke.path),this._extendedMaskPoints=b(this.stroke.points,tw.STROKE_WIDTH/2)}render(t,e){if(e.opacity<.05)return;if(t.save(),this._path2D)t.clip(this._path2D);else{var i;null===(i=this._pathCmd)||void 0===i||i.call(this,t),t.globalAlpha=0,t.stroke(),t.clip()}let{r,g:s,b:o,a:n}=this._getColor(e),a=1===n?`rgb(${r},${s},${o})`:`rgb(${r},${s},${o},${n})`,h=this._getStrokeDashoffset(e.displayPortion);t.globalAlpha=e.opacity,t.strokeStyle=a,t.fillStyle=a,t.lineWidth=tw.STROKE_WIDTH,t.lineCap="round",t.lineJoin="round",t.setLineDash([this._pathLength,this._pathLength],h),t.lineDashOffset=h,tO(t,this._extendedMaskPoints),t.restore()}}class tz{constructor(t){this._strokeRenderers=t.strokes.map(t=>new tE(t))}render(t,e){if(e.opacity<.05)return;let{opacity:i,strokeColor:r,radicalColor:s,strokes:o}=e;for(let e=0;e<this._strokeRenderers.length;e++)this._strokeRenderers[e].render(t,{strokeColor:r,radicalColor:s,opacity:o[e].opacity*i,displayPortion:o[e].displayPortion||0})}}class tI{constructor(t,e){this.destroy=m,this._character=t,this._positioner=e,this._mainCharRenderer=new tz(t),this._outlineCharRenderer=new tz(t),this._highlightCharRenderer=new tz(t)}mount(t){this._target=t}_animationFrame(t){let{width:e,height:i,scale:r,xOffset:s,yOffset:o}=this._positioner,n=this._target.getContext();n.clearRect(0,0,e,i),n.save(),n.translate(s,i-o),n.transform(1,0,0,-1,0,0),n.scale(r,r),t(n),n.restore(),n.draw&&n.draw()}render(t){let{outline:e,main:i,highlight:r}=t.character,{outlineColor:s,strokeColor:o,radicalColor:n,highlightColor:a,drawingColor:h,drawingWidth:l}=t.options;this._animationFrame(u=>{this._outlineCharRenderer.render(u,{opacity:e.opacity,strokes:e.strokes,strokeColor:s}),this._mainCharRenderer.render(u,{opacity:i.opacity,strokes:i.strokes,strokeColor:o,radicalColor:n}),this._highlightCharRenderer.render(u,{opacity:r.opacity,strokes:r.strokes,strokeColor:a});let d=t.userStrokes||{};for(let t in d){let e=d[t];e&&function(t,e){if(e.opacity<.05)return;let{opacity:i,strokeWidth:r,strokeColor:s,points:o}=e,{r:n,g:a,b:h,a:l}=s;t.save(),t.globalAlpha=i,t.lineWidth=r,t.strokeStyle=`rgba(${n},${a},${h},${l})`,t.lineCap="round",t.lineJoin="round",tO(t,o),t.restore()}(u,{strokeWidth:l,strokeColor:h,...e})}})}}class tF extends tM{constructor(t){super(t)}static init(t,e="100%",i="100%"){let r="string"==typeof t?document.getElementById(t):t;if(!r)throw Error(`HanziWriter target element not found: ${t}`);let s=r.nodeName.toUpperCase(),o=(()=>{if("CANVAS"===s)return r;let t=document.createElement("canvas");return r.appendChild(t),t})();return o.setAttribute("width",e),o.setAttribute("height",i),new tF(o)}getContext(){return this.node.getContext("2d")}}var tW={HanziWriterRenderer:tI,createRenderTarget:tF.init};let tH=t=>`https://cdn.jsdelivr.net/npm/hanzi-writer-data@2.0.1/${t}.json`,tq={charDataLoader:(t,e,i)=>{let r=new XMLHttpRequest;r.overrideMimeType&&r.overrideMimeType("application/json"),r.open("GET",tH(t),!0),r.onerror=t=>{i(r,t)},r.onreadystatechange=()=>{4===r.readyState&&(200===r.status?e(JSON.parse(r.responseText)):0!==r.status&&i&&i(r))},r.send(null)},onLoadCharDataError:null,onLoadCharDataSuccess:null,showOutline:!0,showCharacter:!0,renderer:"svg",width:0,height:0,padding:20,strokeAnimationSpeed:1,strokeFadeDuration:400,strokeHighlightDuration:200,strokeHighlightSpeed:2,delayBetweenStrokes:1e3,delayBetweenLoops:2e3,strokeColor:"#555",radicalColor:null,highlightColor:"#AAF",outlineColor:"#DDD",drawingColor:"#333",leniency:1,showHintAfterMisses:3,highlightOnComplete:!0,highlightCompleteColor:null,markStrokeCorrectAfterMisses:!1,acceptBackwardsStrokes:!1,quizStartStrokeNum:0,averageDistanceThreshold:350,drawingFadeDuration:300,drawingWidth:4,strokeWidth:2,outlineWidth:2,rendererOverride:{}};class tB{constructor(t){this._loadCounter=0,this._isLoading=!1,this.loadingFailed=!1,this._options=t}_debouncedLoad(t,e){let i=t=>{if(e===this._loadCounter){var i;null===(i=this._resolve)||void 0===i||i.call(this,t)}},r=t=>{if(e===this._loadCounter){var i;null===(i=this._reject)||void 0===i||i.call(this,t)}},s=this._options.charDataLoader(t,i,r);s&&("then"in s?s.then(i).catch(r):i(s))}_setupLoadingPromise(){return new Promise((t,e)=>{this._resolve=t,this._reject=e}).then(t=>{var e,i;return this._isLoading=!1,null===(e=(i=this._options).onLoadCharDataSuccess)||void 0===e||e.call(i,t),t}).catch(t=>{if(this._isLoading=!1,this.loadingFailed=!0,this._options.onLoadCharDataError){this._options.onLoadCharDataError(t);return}if(t instanceof Error)throw t;let e=Error(`Failed to load char data for ${this._loadingChar}`);throw e.reason=t,e})}loadCharData(t){this._loadingChar=t;let e=this._setupLoadingPromise();return this.loadingFailed=!1,this._isLoading=!0,this._loadCounter++,this._debouncedLoad(t,this._loadCounter),e}}class tN{constructor(t,e={}){let{HanziWriterRenderer:i,createRenderTarget:r}="canvas"===e.renderer?tW:tL,s=e.rendererOverride||{};this._renderer={HanziWriterRenderer:s.HanziWriterRenderer||i,createRenderTarget:s.createRenderTarget||r},this.target=this._renderer.createRenderTarget(t,e.width,e.height),this._options=this._assignOptions(e),this._loadingManager=new tB(this._options),this._setupListeners()}static create(t,e,i){let r=new tN(t,i);return r.setCharacter(e),r}static loadCharacterData(t,e={}){let i=(()=>{let{_loadingManager:i,_loadingOptions:r}=tN;return(null==i?void 0:i._loadingChar)===t&&r===e?i:new tB({...tq,...e})})();return tN._loadingManager=i,tN._loadingOptions=e,i.loadCharData(t)}static getScalingTransform(t,e,i=0){let r=new q({width:t,height:e,padding:i});return{x:r.xOffset,y:r.yOffset,scale:r.scale,transform:_(`
        translate(${r.xOffset}, ${r.height-r.yOffset})
        scale(${r.scale}, ${-1*r.scale})
      `).replace(/\s+/g," ")}}showCharacter(t={}){return this._options.showCharacter=!0,this._withData(()=>{var e;return null===(e=this._renderState)||void 0===e?void 0:e.run(te("main",this._character,"number"==typeof t.duration?t.duration:this._options.strokeFadeDuration)).then(e=>{var i;return null===(i=t.onComplete)||void 0===i||i.call(t,e),e})})}hideCharacter(t={}){return this._options.showCharacter=!1,this._withData(()=>{var e;return null===(e=this._renderState)||void 0===e?void 0:e.run(ti("main",this._character,"number"==typeof t.duration?t.duration:this._options.strokeFadeDuration)).then(e=>{var i;return null===(i=t.onComplete)||void 0===i||i.call(t,e),e})})}animateCharacter(t={}){return this.cancelQuiz(),this._withData(()=>{var e;return null===(e=this._renderState)||void 0===e?void 0:e.run(th("main",this._character,this._options.strokeFadeDuration,this._options.strokeAnimationSpeed,this._options.delayBetweenStrokes)).then(e=>{var i;return null===(i=t.onComplete)||void 0===i||i.call(t,e),e})})}animateStroke(t,e={}){return this.cancelQuiz(),this._withData(()=>{var i;return null===(i=this._renderState)||void 0===i?void 0:i.run(tn("main",this._character,h(t,this._character.strokes.length),this._options.strokeAnimationSpeed)).then(t=>{var i;return null===(i=e.onComplete)||void 0===i||i.call(e,t),t})})}highlightStroke(t,e={}){return this._withData(()=>{if(this._character&&this._renderState)return this._renderState.run(ts(l(this._character.strokes,t),c(this._options.highlightColor),this._options.strokeHighlightSpeed)).then(t=>{var i;return null===(i=e.onComplete)||void 0===i||i.call(e,t),t})})}async loopCharacterAnimation(){return this.cancelQuiz(),this._withData(()=>this._renderState.run(tl("main",this._character,this._options.strokeFadeDuration,this._options.strokeAnimationSpeed,this._options.delayBetweenStrokes,this._options.delayBetweenLoops),{loop:!0}))}pauseAnimation(){return this._withData(()=>{var t;return null===(t=this._renderState)||void 0===t?void 0:t.pauseAll()})}resumeAnimation(){return this._withData(()=>{var t;return null===(t=this._renderState)||void 0===t?void 0:t.resumeAll()})}showOutline(t={}){return this._options.showOutline=!0,this._withData(()=>{var e;return null===(e=this._renderState)||void 0===e?void 0:e.run(te("outline",this._character,"number"==typeof t.duration?t.duration:this._options.strokeFadeDuration)).then(e=>{var i;return null===(i=t.onComplete)||void 0===i||i.call(t,e),e})})}hideOutline(t={}){return this._options.showOutline=!1,this._withData(()=>{var e;return null===(e=this._renderState)||void 0===e?void 0:e.run(ti("outline",this._character,"number"==typeof t.duration?t.duration:this._options.strokeFadeDuration)).then(e=>{var i;return null===(i=t.onComplete)||void 0===i||i.call(t,e),e})})}updateDimensions({width:t,height:e,padding:i}){if(void 0!==t&&(this._options.width=t),void 0!==e&&(this._options.height=e),void 0!==i&&(this._options.padding=i),this.target.updateDimensions(this._options.width,this._options.height),this._character&&this._renderState&&this._hanziWriterRenderer&&this._positioner){this._hanziWriterRenderer.destroy();let t=this._initAndMountHanziWriterRenderer(this._character);this._renderState.overwriteOnStateChange(e=>t.render(e)),t.render(this._renderState.state),this._quiz&&this._quiz.setPositioner(this._positioner)}}updateColor(t,e,i={}){var r;let s=[],o=c("radicalColor"!==t||e?e:this._options.strokeColor);this._options[t]=e;let n=null!==(r=i.duration)&&void 0!==r?r:this._options.strokeFadeDuration;return s=s.concat(tr(t,o,n)),"radicalColor"!==t||e||(s=s.concat(tr(t,null,0))),this._withData(()=>{var t;return null===(t=this._renderState)||void 0===t?void 0:t.run(s).then(t=>{var e;return null===(e=i.onComplete)||void 0===e||e.call(i,t),t})})}quiz(t={}){return this._withData(async()=>{this._character&&this._renderState&&this._positioner&&(this.cancelQuiz(),this._quiz=new tm(this._character,this._renderState,this._positioner),this._options={...this._options,...t},this._quiz.startQuiz(this._options))})}skipQuizStroke(){this._quiz&&this._quiz.nextStroke()}cancelQuiz(){this._quiz&&(this._quiz.cancel(),this._quiz=void 0)}setCharacter(t){return this.cancelQuiz(),this._char=t,this._hanziWriterRenderer&&this._hanziWriterRenderer.destroy(),this._renderState&&this._renderState.cancelAll(),this._hanziWriterRenderer=null,this._withDataPromise=this._loadingManager.loadCharData(t).then(e=>{if(!e||this._loadingManager.loadingFailed)return;this._character=new z(t,function({radStrokes:t,strokes:e,medians:i}){let r=e=>{var i;return(null!==(i=null==t?void 0:t.indexOf(e))&&void 0!==i?i:-1)>=0};return e.map((t,e)=>new E(t,i[e].map(t=>{let[e,i]=t;return{x:e,y:i}}),e,r(e)))}(e)),this._renderState=new f(this._character,this._options,t=>i.render(t));let i=this._initAndMountHanziWriterRenderer(this._character);i.render(this._renderState.state)}),this._withDataPromise}_initAndMountHanziWriterRenderer(t){let{width:e,height:i,padding:r}=this._options;this._positioner=new q({width:e,height:i,padding:r});let s=new this._renderer.HanziWriterRenderer(t,this._positioner);return s.mount(this.target),this._hanziWriterRenderer=s,s}async getCharacterData(){if(!this._char)throw Error("setCharacter() must be called before calling getCharacterData()");return await this._withData(()=>this._character)}_assignOptions(t){let e={...tq,...t};return t.strokeAnimationDuration&&!t.strokeAnimationSpeed&&(e.strokeAnimationSpeed=500/t.strokeAnimationDuration),t.strokeHighlightDuration&&!t.strokeHighlightSpeed&&(e.strokeHighlightSpeed=500/e.strokeHighlightDuration),t.highlightCompleteColor||(e.highlightCompleteColor=e.highlightColor),this._fillWidthAndHeight(e)}_fillWidthAndHeight(t){let e={...t};if(e.width&&!e.height)e.height=e.width;else if(e.height&&!e.width)e.width=e.height;else if(!e.width&&!e.height){let{width:t,height:i}=this.target.getBoundingClientRect(),r=Math.min(t,i);e.width=r,e.height=r}return e}_withData(t){if(this._loadingManager.loadingFailed)throw Error("Failed to load character data. Call setCharacter and try again.");return this._withDataPromise?this._withDataPromise.then(()=>{if(!this._loadingManager.loadingFailed)return t()}):Promise.resolve().then(t)}_setupListeners(){this.target.addPointerStartListener(t=>{this._quiz&&(t.preventDefault(),this._quiz.startUserStroke(t.getPoint()))}),this.target.addPointerMoveListener(t=>{this._quiz&&(t.preventDefault(),this._quiz.continueUserStroke(t.getPoint()))}),this.target.addPointerEndListener(()=>{var t;null===(t=this._quiz)||void 0===t||t.endUserStroke()})}}tN._loadingManager=null,tN._loadingOptions=null,e.default=tN}}]);