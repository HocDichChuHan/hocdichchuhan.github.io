(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2626],{31095:function(e,t,n){Promise.resolve().then(n.bind(n,45356))},21409:function(e,t,n){"use strict";function r(e){let{src:t,width:n,quality:r}=e;return"".concat("").concat(t)}n.r(t),n.d(t,{default:function(){return r}})},3216:function(e,t,n){"use strict";var r=n(2265);let i=[{background:"linear-gradient(135deg, #192A51,rgb(14, 4, 107))",color:"#FFFFFF",primaryColor:"#967AA1"},{background:"#1A1A2E",color:"#FFFFFF",primaryColor:"#0F3460"},{background:"#461220",color:"#FFFFFF",primaryColor:"#E94560"},{background:"#F7B267",color:"#000000",primaryColor:"#F4845F"},{background:"#F25F5C",color:"#000000",primaryColor:"#642B36"},{background:"#231F20",color:"#FFF",primaryColor:"#BB4430"}],o=e=>{let t=document.querySelector(":root");t.style.setProperty("--background",e.background),t.style.setProperty("--color",e.color),t.style.setProperty("--primary-color",e.primaryColor),t.style.setProperty("--glass-color",e.glassColor)};t.Z=()=>((0,r.useEffect)(()=>{let e=document.querySelector(".theme-btn-container");i.forEach(t=>{let n=document.createElement("div");n.className="theme-btn",n.style.cssText="background: ".concat(t.background,"; width: 25px; height: 25px"),e.appendChild(n),n.addEventListener("click",()=>o(t))})},[]),null)},45356:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return w}});var r=n(57437),i=n(2265);n(87148);var o=n(3216),s=n(64379),a=n.n(s);n(97796);var c=n(65606),l=n(87138),u=n(66648),h=n(16463),d=n(60516),g=n(12808),m=n(93539);function f(e){let{isStudy:t,onLoginSuccessybd:n}=e,[o,s]=(0,i.useState)(null),[h,f]=(0,i.useState)(!1);(0,i.useRef)(null),(0,i.useEffect)(()=>{let e=localStorage.getItem("userLogin");if(e){let n=JSON.parse(e);if(s(n),!t)return;(0,c.o3)(n.uid,c.db),f(!0)}},[t]),(0,i.useEffect)(()=>{if(!o)return;let e=(0,d.iH)(c.db,"user/status/".concat(o.uid)),t=(0,d.jM)(e,e=>{var t;f(e.exists()&&(null===(t=e.val())||void 0===t?void 0:t.isOnline))});return()=>t()},[o,h]),(0,i.useEffect)(()=>(window.addEventListener("beforeunload",p),()=>window.removeEventListener("beforeunload",p)),[]);let p=async()=>{let e=JSON.parse(localStorage.getItem("userLogin"));e&&(await (0,c.Z3)(e.uid,c.db),f(!1))};(0,i.useEffect)(()=>{if(!o||!t)return;let e=setInterval(()=>{(async()=>{await (0,c.Z3)(o.uid,c.db),f(!1),(await a().fire({title:"\uD83E\uDDE0 Bạn vẫn đang học chứ?",text:"Vui l\xf2ng x\xe1c nhận để tiếp tục phi\xean học.",icon:"question",showCancelButton:!1,confirmButtonText:"Đang học",cancelButtonText:"Tạm nghỉ"})).isConfirmed?(f(!0),await (0,c.o3)(o.uid,c.db),console.log("✅ Người d\xf9ng x\xe1c nhận đang học")):console.log("⏸️ Người d\xf9ng tạm nghỉ")})()},18e5);return()=>clearInterval(e)},[o]),(0,i.useEffect)(()=>{if(!o||!t||!h)return;let e=setInterval(async()=>{let e=new Date().toISOString().slice(0,10),t=(0,d.iH)(c.db,"user/activityLogs/".concat(o.uid,"/").concat(e)),n=await (0,d.U2)(t);if(n.exists()){let e=n.val(),r=new Date(e.currentSessionStart),i=new Date;if(!isNaN(r.getTime())){let n=(e.totalSeconds||0)+Math.floor((i-r)/1e3);await (0,d.t8)(t,{...e,totalSeconds:n,currentSessionStart:i.toISOString()})}}},6e4);return()=>clearInterval(e)},[o,t,h]);let w=async()=>{try{let e=await (0,c.Cb)();console.log(e);let t=e.user,n="user/account/".concat(t.uid),r=(0,d.iH)(c.db,n);if((await (0,d.U2)(r)).exists())console.log("\uD83D\uDCE6 User đ\xe3 tồn tại tr\xean Realtime Database");else{let e={uid:t.uid,name:t.displayName,email:t.email,photoURL:t.photoURL,createdAt:new Date().toISOString()};await (0,d.t8)(r,e),console.log("\uD83C\uDD95 Tạo user mới tr\xean Realtime Database")}let i={uid:t.uid,name:t.displayName,email:t.email,photoURL:t.photoURL};localStorage.setItem("userLogin",JSON.stringify(i)),s(i),onLoginSuccess(),await (0,c.o3)(t.uid)}catch(e){console.error("❌ Lỗi đăng nhập:",e)}},y=async()=>{let e=JSON.parse(localStorage.getItem("userLogin"));e&&await (0,c.Z3)(e.uid,c.db),(0,c.kS)(),localStorage.clear(),sessionStorage.clear(),s(null)};return(0,r.jsx)("div",{className:"d-flex align-items-center gap-3 w-100",children:o?(0,r.jsxs)("div",{className:"d-flex align-items-center position-relative",children:[(0,r.jsx)("span",{className:"me-2 fw-semibold text-white d-none d-sm-inline",children:o.name}),(0,r.jsxs)(m.Z,{align:"end",children:[(0,r.jsx)(m.Z.Toggle,{variant:"light",id:"dropdown-avatar",className:"p-0 border-0 bg-transparent",children:(0,r.jsx)(u.default,{src:o.photoURL,alt:"avatar",width:"40",height:"40",className:"rounded-circle border border-1"})}),(0,r.jsxs)(m.Z.Menu,{children:[(0,r.jsx)(m.Z.Item,{href:"/profile",children:"Trang c\xe1 nh\xe2n"}),(0,r.jsx)(m.Z.Divider,{}),(0,r.jsx)(m.Z.Item,{onClick:()=>y(),children:"Đăng xuất"}),(0,r.jsx)(m.Z.Divider,{}),(0,r.jsx)(l.default,{href:"/hsk/baitap",passHref:!0,legacyBehavior:!0,children:(0,r.jsx)(m.Z.Item,{children:"B\xe0i Tập"})})]})]})]}):(0,r.jsxs)(g.Z,{onClick:()=>w(),className:"submitButton w-100",children:[(0,r.jsx)(u.default,{src:"https://cdn1.iconfinder.com/data/icons/google-s-logo/150/Google_Icons-09-512.png",alt:"logo",width:"40",height:"40",className:"rounded-circle border border-1 me-2"}),(0,r.jsx)("span",{className:"",children:"Login with Google"})]})})}class p extends i.Component{componentDidMount(){(localStorage.getItem("user")||localStorage.getItem("userLogin"))&&this.setState({user:!0})}componentDidUpdate(){this.state.user&&(0,h.redirect)("/hsk")}setWithExpiry(e,t,n){let r={value:t,expiry:new Date().getTime()+n};localStorage.setItem(e,JSON.stringify(r))}getWithExpiry(e){let t=localStorage.getItem(e);if(!t)return null;let n=JSON.parse(t);return new Date().getTime()>n.expiry?(localStorage.removeItem(e),null):n.value}render(){let{user:e,error:t,showPassword:n}=this.state;return(0,r.jsxs)("section",{className:"container-show",children:[(0,r.jsxs)("div",{className:"login-container",children:[t&&(0,r.jsx)("p",{children:t.message}),(0,r.jsx)("div",{className:"circle circle-one"}),(0,r.jsxs)("div",{className:"form-container",children:[(0,r.jsxs)("h1",{className:"site-title ",children:[(0,r.jsx)("span",{className:"title-main",children:"Tiếng Trung"}),(0,r.jsx)("span",{className:"title-highlight",children:"DONG YANG"}),(0,r.jsx)("span",{className:"title-smallText tiengtrungText",children:"东阳汉字"})]}),(0,r.jsxs)("form",{onSubmit:this.handleSubmit,children:[(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"text",name:"username",placeholder:"T\xean đăng nhập"})}),(0,r.jsxs)("div",{className:"input-password",children:[(0,r.jsx)("input",{type:n?"text":"password",name:"password",placeholder:"Mật khẩu"}),(0,r.jsx)("div",{className:n?"hide":"positsionPassword",onClick:this.togglePasswordVisibility,children:(0,r.jsx)("i",{className:"fa-solid fa-eye"})}),(0,r.jsx)("div",{className:n?"positsionPassword":"hide",onClick:this.togglePasswordVisibility,children:(0,r.jsx)("i",{className:"fa-regular fa-eye-slash"})})]}),(0,r.jsx)("button",{type:"submit",className:"submitButton",children:"Đăng nhập"})]}),(0,r.jsx)(f,{isStudy:!1,onLoginSuccess:this.handleGoogleLoginSuccess}),(0,r.jsxs)("div",{className:"register-forget ",children:[(0,r.jsx)(l.default,{className:"nav-link text-secondary",href:"/register",children:"Đăng k\xfd"}),(0,r.jsx)(l.default,{className:"nav-link text-secondary",href:"",children:"Qu\xean mật khẩu"})]})]}),(0,r.jsx)("div",{className:"circle circle-two"})]}),(0,r.jsx)("div",{className:"theme-btn-container"}),(0,r.jsx)(o.Z,{})]})}constructor(...e){super(...e),this.state={user:null,error:null,showPassword:!1},this.togglePasswordVisibility=()=>{this.setState(e=>({showPassword:!e.showPassword}))},this.playAudio=()=>{this.audioRef&&(this.audioRef.play(),window.removeEventListener("click",this.playAudio))},this.handleSubmit=async e=>{e.preventDefault();let t=new FormData(e.target),n=t.get("username"),r=t.get("password");try{let e=await this.getInfo("/user/account/".concat(n));if(!e)return a().fire({position:"center",icon:"info",title:"Người d\xf9ng kh\xf4ng tồn tại",showConfirmButton:!1,timer:1500});if(e.password!==r)return a().fire({position:"center",icon:"info",title:"Mật khẩu kh\xf4ng ch\xednh x\xe1c, vui l\xf2ng thử lại",showConfirmButton:!1,timer:1500});let t={uid:e.uid,name:e.displayName,email:e.email,photoURL:e.photoURL};localStorage.setItem("userLogin",JSON.stringify(t)),await a().fire({position:"center",icon:"success",title:"Đăng nhập th\xe0nh c\xf4ng",showConfirmButton:!1,timer:1500}),this.setState({user:!0})}catch(e){console.error("Lỗi đăng nhập:",e),a().fire({position:"center",icon:"info",title:"Lỗi đăng nhập: "+e.message,showConfirmButton:!1,timer:1500}),this.setState({error:{message:e.message}})}},this.getInfo=async e=>{try{let t=await (0,c.F3)(e);if(null!==t)return t}catch(e){throw console.error("C\xf3 lỗi xảy ra:",e),e}},this.handleGoogleLoginSuccess=()=>{this.setState({user:!0})}}}var w=p},65606:function(e,t,n){"use strict";n.d(t,{Cb:function(){return k},F3:function(){return f},Gd:function(){return x},Je:function(){return l},Pf:function(){return h},Tn:function(){return u},UD:function(){return w},VP:function(){return m},Z3:function(){return L},Z6:function(){return g},_g:function(){return d},db:function(){return c},eO:function(){return p},kS:function(){return N},kX:function(){return S},o3:function(){return j}});var r=n(15236);n(19675);var i=n(75735),o=n(60516),s=n(69842);let a=(0,r.ZF)({apiKey:"AIzaSyD9IyIValBX6xooTZ3wsBPfKsyYvNwAWik",authDomain:"dichchuhan-55a4d.firebaseapp.com",databaseURL:"https://dichchuhan-55a4d-default-rtdb.firebaseio.com",projectId:"dichchuhan-55a4d",storageBucket:"dichchuhan-55a4d.appspot.com",messagingSenderId:"589658521880",appId:"1:589658521880:web:65694d6b4f17f4ca6b1e6d",measurementId:"G-G02KSBMR52"}),c=(0,o.N8)(a);function l(){var e=document.getElementById("fileList").value,t=document.querySelector(".content-right").value,n={[e]:t},r="/users/user1/kecheng/".concat(e),i="/users/user1/contents/".concat(e),s=(0,o.iH)(c,i);(0,o.t8)(s,n).then(()=>{console.log("Dữ liệu b\xe0i dịch đ\xe3 được ghi th\xe0nh c\xf4ng l\xean Firebase.")}).catch(e=>{console.error("Lỗi khi ghi dữ liệu b\xe0i dịch:",e)}),s=(0,o.iH)(c,r),n={[e]:t=document.querySelector(".content-left").value},(0,o.t8)(s,n).then(()=>{console.log("Dữ liệu kecheng đ\xe3 được ghi th\xe0nh c\xf4ng l\xean Firebase.")}).catch(e=>{console.error("Lỗi khi ghi dữ liệu kecheng:",e)})}function u(e){var t={[e]:"".concat(e," phần dịch")},n="/users/user1/kecheng/".concat(e),r="/users/user1/contents/".concat(e),i=(0,o.iH)(c,r);(0,o.t8)(i,t).then(()=>{console.log("Dữ liệu b\xe0i dịch đ\xe3 được ghi th\xe0nh c\xf4ng l\xean Firebase.")}).catch(e=>{console.error("Lỗi khi ghi dữ liệu b\xe0i dịch:",e)}),i=(0,o.iH)(c,n),t={[e]:"".concat(e," 中文")},(0,o.t8)(i,t).then(()=>{console.log("Dữ liệu kecheng đ\xe3 được ghi th\xe0nh c\xf4ng l\xean Firebase.")}).catch(e=>{console.error("Lỗi khi ghi dữ liệu kecheng:",e)})}async function h(e,t){var n=(0,o.iH)(c,e);try{return await (0,o.t8)(n,t),!0}catch(e){throw console.error("C\xf3 lỗi xảy ra:",e),e}}function d(e){var t=(0,o.iH)(c,"/users/user1/contents/".concat(e));(0,o.Od)(t).then(()=>{console.log("Dữ liệu b\xe0i dịch đ\xe3 được x\xf3a th\xe0nh c\xf4ng từ Firebase.")}).catch(e=>{console.error("Lỗi khi x\xf3a dữ liệu b\xe0i dịch:",e)}),t=(0,o.iH)(c,"/users/user1/kecheng/".concat(e)),(0,o.Od)(t).then(()=>{console.log("Dữ liệu kecheng đ\xe3 được x\xf3a th\xe0nh c\xf4ng từ Firebase.")}).catch(e=>{console.error("Lỗi khi x\xf3a dữ liệu kecheng:",e)})}async function g(e){var t=(0,o.iH)(c,e);try{return await (0,o.Od)(t),!0}catch(e){throw console.error("C\xf3 lỗi xảy ra:",e),e}}function m(){var e=document.getElementById("fileList").value,t="/users/user1/kecheng/".concat(e,"/").concat(e),n="/users/user1/contents/".concat(e,"/").concat(e);console.log(t),console.log(f(n)),f(n).then(e=>{null!==e&&(document.querySelector(".content-right").value=e)}).catch(e=>{console.error("C\xf3 lỗi xảy ra:",e)}),f(t).then(e=>{null!==e&&(document.querySelector(".content-left").value=e)}).catch(e=>{console.error("C\xf3 lỗi xảy ra:",e)})}function f(e){return new Promise((t,n)=>{var r=(0,o.iH)(c,e);(0,o.U2)(r).then(e=>{e.exists()?t(e.val()):(console.log("Kh\xf4ng c\xf3 dữ liệu tại đường dẫn n\xe0y."),t(null))}).catch(e=>{console.error("Lỗi khi đọc dữ liệu:",e),n(e)})})}async function p(e){var t=(0,o.iH)(c,e);try{var n=await (0,o.U2)(t);if(n.exists())return n.val();return null}catch(e){return console.error("Lỗi khi đọc dữ liệu:",e),null}}function w(e){return new Promise((t,n)=>{var r=(0,o.iH)(c,e);(0,o.U2)(r).then(e=>{e.exists()?t(Object.entries(e.val()).map(e=>{let[t,n]=e;return{key:t,value:n}})):t(null)}).catch(e=>{console.error("Lỗi khi đọc dữ liệu:",e),n(e)})})}(0,s.ad)(a);let y="users/user1/contents";async function x(){let e=(0,o.iH)(c,y),t=await (0,o.U2)(e);t.exists()?(v(Object.keys(t.val())),m()):console.log("Kh\xf4ng c\xf3 dữ liệu tại đường dẫn n\xe0y.")}async function S(e){let t=(0,o.iH)(c,y),n=await (0,o.U2)(t);if(n.exists()){var r,i;v(Object.keys(n.val())),r="/users/user1/kecheng/".concat(e,"/").concat(e),i="/users/user1/contents/".concat(e,"/").concat(e),document.getElementById("fileList").value=e,f(i).then(e=>{null!==e&&(document.querySelector(".content-right").value=e)}).catch(e=>{console.error("C\xf3 lỗi xảy ra:",e)}),f(r).then(e=>{null!==e&&(document.querySelector(".content-left").value=e)}).catch(e=>{console.error("C\xf3 lỗi xảy ra:",e)})}else console.log("Kh\xf4ng c\xf3 dữ liệu tại đường dẫn n\xe0y.")}function v(e){let t=document.getElementById("fileList");for(;t.firstChild;)t.removeChild(t.firstChild);e.forEach(e=>{let n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)})}let b=(0,i.v0)(a);async function k(){let e=new i.hJ;try{return await (0,i.rh)(b,e)}catch(e){throw console.error("Lỗi đăng nhập:",e),e}}new i.hJ;let N=async()=>{if(!b.currentUser){console.warn("No user currently signed in.");return}try{await (0,i.w7)(b),console.log("User signed out")}catch(e){console.error("Logout failed:",e)}},j=async e=>{let t=new Date().toISOString().slice(0,10),n=(0,o.iH)(c,"user/activityLogs/".concat(e,"/").concat(t)),r=(0,o.iH)(c,"user/status/".concat(e));(await (0,o.U2)(n)).exists()?await (0,o.Vx)(n,{currentSessionStart:new Date().toISOString()}):await (0,o.t8)(n,{currentSessionStart:new Date().toISOString(),totalSeconds:0}),console.log("markUserOnline"),await (0,o.t8)(r,{isOnline:!0,timestamp:new Date().toISOString()}),(0,o.ae)(r).set({isOnline:!1,timestamp:new Date().toISOString()})},L=async e=>{let t=new Date().toISOString().slice(0,10),n=(0,o.iH)(c,"user/activityLogs/".concat(e,"/").concat(t)),r=(0,o.iH)(c,"user/status/".concat(e)),i=await (0,o.U2)(n);if(i.exists()){let e=i.val(),t=new Date(e.currentSessionStart),r=new Date;if(isNaN(t.getTime())){console.warn("⚠️ currentSessionStart kh\xf4ng hợp lệ:",e.currentSessionStart);return}let s=Math.floor((r-t)/1e3),a="number"==typeof e.totalSeconds?e.totalSeconds:0;if(isNaN(s)||isNaN(a)){console.warn("⚠️ Gi\xe1 trị thời gian kh\xf4ng hợp lệ:",{sessionSeconds:s,previousTotal:a});return}await (0,o.Vx)(n,{endTime:r.toISOString(),totalSeconds:a+s,currentSessionStart:null})}await (0,o.t8)(r,{isOnline:!1,timestamp:new Date().toISOString()})}},87148:function(){},97796:function(){}},function(e){e.O(0,[677,4358,7481,9208,9461,8765,4974,3539,2971,7023,1744],function(){return e(e.s=31095)}),_N_E=e.O()}]);