(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1818],{3488:function(e,t,n){Promise.resolve().then(n.bind(n,68176))},68176:function(e,t,n){"use strict";n.d(t,{default:function(){return x}});var a=n(57437),r=n(2265),l=n(66802),s=n(12808);n(19768);var i=n(23508),c=n(60516),o=n(65606),u=n(64379),d=n.n(u),m=n(66648),h=n(32608),p=n(57295),f=n(27593);function v(e){let{images:t,currentPage:n,onPageChange:l,mucluc:i,pagenum:c,pageSingle:o=!1,showMucluc:u}=e,[d,f]=(0,r.useState)(void 0!==c?c:0),v=Number(void 0!==n?n:d)-1,g=l||f,[x,j]=(0,r.useState)(""),[b,w]=(0,r.useState)(o),[N,y]=(0,r.useState)(null);(0,r.useRef)(null),(0,r.useRef)(null),(0,r.useRef)(null);let S=(0,r.useRef)(null),k=b?[v+1]:[v+1,v+2],C=i.flatMap(e=>e.content).filter(e=>{var t;let n=null===(t=e.pagenum)||void 0===t?void 0:t.toString().split(";").map(e=>Number(e.trim())).filter(e=>!isNaN(e));return(null==n?void 0:n.some(e=>k.includes(e)))&&e.nguphap});(0,r.useEffect)(()=>{let e=()=>{window.innerWidth<1200||o?w(!0):w(!1)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let D=(0,r.useRef)([]),E=(0,r.useRef)(),M=(0,r.useRef)();(0,r.useEffect)(()=>{D.current=C.map((e,t)=>e.nguphap?e.nguphap.map((e,n)=>{var a,l;return null!==(l=null===(a=D.current[t])||void 0===a?void 0:a[n])&&void 0!==l?l:r.createRef()}):[])},[C]);let[L,R]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=()=>R(window.scrollY>300);return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]);let Z=i.flatMap(e=>e.content).filter(e=>{var t;let n=null===(t=e.pagenum)||void 0===t?void 0:t.toString().split(";").map(e=>Number(e.trim())).filter(e=>!isNaN(e));return(null==n?void 0:n.some(e=>k.includes(e)))&&e.mp3link}),T=i.flatMap(e=>e.content).filter(e=>{var t;let n=null===(t=e.pagenum)||void 0===t?void 0:t.toString().split(";").map(e=>Number(e.trim())).filter(e=>!isNaN(e));return(null==n?void 0:n.some(e=>k.includes(e)))&&e.tumoi});return(0,a.jsxs)("div",{ref:E,className:"container d-flex flex-column justify-content-center align-items-center my-4",children:[(0,a.jsxs)("div",{className:"hoverButtonPage",style:{position:"fixed",top:"50%",right:"10px",display:"flex",flexDirection:"column",gap:"6px",zIndex:9999,transform:"translateY(-50%)"},children:[C.flatMap((e,t)=>e.nguphap.map((e,n)=>(0,a.jsxs)(s.Z,{size:"sm",variant:"outline-success",onClick:()=>{var e,a;return null===(a=D.current[t][n])||void 0===a?void 0:null===(e=a.current)||void 0===e?void 0:e.scrollIntoView({behavior:"smooth",block:"start"})},children:["✏ ",t+1,".",n+1]},"".concat(t,"-").concat(n)))),(0,a.jsx)(s.Z,{size:"sm",variant:"outline-success",onClick:()=>u(),children:"\uD83D\uDCD8"},"muclucRefButton")]}),L&&(0,a.jsx)(s.Z,{variant:"primary",className:"btn-back-to-top ",onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),children:(0,a.jsx)("i",{className:"fas fa-arrow-up"})}),(0,a.jsxs)("div",{className:"position-relative w-100 d-flex justify-content-center align-items-center",children:[(0,a.jsx)("button",{className:"btn hoverButtonPage z-1 btn-outline-primary position-absolute start-0 top-50 translate-middle-y",onClick:()=>{b?v>0&&g(v):v>0&&g(v-1)},disabled:0===v,children:"⬅"}),(0,a.jsxs)("div",{className:"book shadow-lg rounded overflow-hidden",children:[(0,a.jsx)("div",{className:"page border bg-white flip",children:t[v]&&(0,a.jsx)(m.default,{src:t[v],alt:"Page ".concat(v+1),width:600,height:850})}),!b&&(0,a.jsx)("div",{className:"page border bg-white flip",children:t[v+1]&&(0,a.jsx)(m.default,{src:t[v+1],alt:"Page ".concat(v+2),width:600,height:850,style:{width:b?"100%":"600px",height:b?"auto":"850px"}})})]}),(0,a.jsx)("button",{className:"btn hoverButtonPage z-1 btn-outline-primary position-absolute end-0 top-50 translate-middle-y",onClick:()=>{b?(console.log(v),v<t.length-1&&g(v+2),console.log(v+2)):v<t.length-2&&g(v+2)},disabled:v>=t.length-(b?1:2),children:"➡"})]}),(0,a.jsxs)("div",{className:"row border rounded mt-2 p-1 m-3 w-100",children:[Z.length>0&&(0,a.jsx)("div",{className:"col",children:(0,a.jsx)("div",{className:"audio-controls mt-3 d-flex flex-wrap justify-content-center gap-2",children:Z.map((e,t)=>(0,a.jsxs)("div",{className:"Playmp3Container mb-2 w-100",children:[(0,a.jsxs)("div",{className:"fs-5",children:["Hội thoại ",t+1,". ",e.name]}),(0,a.jsx)(h.Z,{mp3:e.mp3link,tieude:e.name}),(0,a.jsx)("hr",{})]},"".concat(e.number,"-").concat(t)))})}),T.length>0&&(0,a.jsx)("div",{className:"col-12",children:(0,a.jsx)("div",{className:"audio-controls mt-3 d-flex flex-wrap justify-content-center gap-2",children:(0,a.jsx)("div",{className:"scroll-tumoi-container w-100",ref:S,children:T.map((e,t)=>(0,a.jsx)("div",{className:"",children:(0,a.jsx)(p.Z,{tumoi:e.tumoi,isGianthe:!0,isShowpinyin:!0})},"".concat(e.number,"-").concat(t)))})})})]}),C.length>0&&(0,a.jsx)("div",{className:"audio-controls mt-3 d-flex flex-wrap justify-content-center gap-2",children:C.map((e,t)=>(0,a.jsxs)("div",{className:"Playmp3Container mb-2",children:[e.nguphap&&e.nguphap.map((n,r)=>{var l,s;return(0,a.jsx)("div",{ref:(null===(s=D.current)||void 0===s?void 0:null===(l=s[t])||void 0===l?void 0:l[r])||null,children:n&&(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:n}})},"".concat(e.number,"-").concat(t,"-").concat(r))}),(0,a.jsx)("hr",{})]},"".concat(e.number,"-").concat(t)))}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault();let n=parseInt(x,10)-1;!isNaN(n)&&(b||n%2==0||(n-=1),n>=0&&n<t.length&&g(n)),j("")},className:"mb-3 d-flex align-items-center gap-2",ref:M,children:[(0,a.jsx)("input",{type:"number",className:"form-control",placeholder:"Trang ".concat(b?v+1:v+2),value:x,onChange:e=>j(e.target.value),style:{width:"150px"}}),(0,a.jsx)("button",{className:"btn  btn-primary",type:"submit",children:"Go"})]})]})}n(16896),n(67631);var g=n(87138);function x(e){let{hsk:t}=e,[n,u]=(0,r.useState)(!0),[m,h]=(0,r.useState)(!1),[p,x]=(0,r.useState)(!1),[j,b]=(0,r.useState)([]),[w,N]=(0,r.useState)(1),[y,S]=(0,r.useState)(1),[k,C]=(0,r.useState)(!1),[D,E]=(0,r.useState)(!1),[M,L]=(0,r.useState)(null),[R,Z]=(0,r.useState)(!1),[T,P]=(0,r.useState)([]),[_,z]=(0,r.useState)([]),[B,H]=(0,r.useState)(null),I=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=e=>{I.current&&!I.current.contains(e.target)&&C(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,r.useEffect)(()=>{let e=(0,i.GJ)(),n=(0,i.bg)();x(e),h(n),(async()=>{u(!0),d().fire({title:"Đang tải dữ liệu...",text:"Vui l\xf2ng chờ trong gi\xe2y l\xe1t",allowOutsideClick:!1,didOpen:()=>d().showLoading()});try{let e=(0,c.iH)(o.db,"/users/book/".concat(t)),n=await (0,c.U2)(e);if(n.exists()){let e=n.val();if(b(e.mucluc||""),L(e.thamchieu||null),e.thamchieu){let t=(0,c.iH)(o.db,"/users/book/".concat(e.thamchieu)),n=await (0,c.U2)(t);if(n.exists()){let e=n.val();P(e.mucluc||null)}}}d().close()}catch(e){console.error("Lỗi khi lấy dữ liệu:",e),d().fire({icon:"error",title:"Lỗi khi tải dữ liệu",text:e.message||"Đ\xe3 xảy ra lỗi kh\xf4ng x\xe1c định."})}finally{u(!1)}})()},[t]),(0,r.useEffect)(()=>{let e=()=>E(window.scrollY>60);return window.addEventListener("scroll",e),e(),()=>window.removeEventListener("scroll",e)},[]);let U=Array.from({length:300},(e,n)=>{let a=String(n+1).padStart(4,"0");return"https://duongchung1999.github.io/hsk/".concat(t,"/").concat(t.toUpperCase(),"_page-").concat(a,".jpg")}),F=Array.from({length:300},(e,t)=>{let n=String(t+1).padStart(4,"0");return"https://duongchung1999.github.io/hsk/".concat(M||"","/").concat((M||"").toUpperCase(),"_page-").concat(n,".jpg")});return(0,r.useEffect)(()=>{let e=window.location.hash.replace("#","");e&&!isNaN(e)&&N(Number(e));let t=()=>{let e=window.location.hash.replace("#","");e&&!isNaN(e)&&N(Number(e))};return window.addEventListener("hashchange",t),()=>window.removeEventListener("hashchange",t)},[]),(0,r.useEffect)(()=>{w&&window.history.replaceState(null,"","#".concat(w))},[w]),(0,r.useEffect)(()=>{j&&0!==j.length&&(console.log(w),z(j.flatMap(e=>e.content).filter(e=>{var t;let n=null===(t=e.pagenum)||void 0===t?void 0:t.toString().split(";").map(e=>Number(e.trim())).filter(e=>!isNaN(e));return(null==n?void 0:n.some(e=>w===e))&&e.pagethamchieu})))},[j,w]),(0,a.jsx)(l.Z,{body:(0,a.jsxs)("div",{style:{display:"flex",position:"relative"},children:[_.length>0&&R&&(0,a.jsx)(f.Z,{show:R,onClose:()=>Z(!1),children:(0,a.jsx)("div",{className:"w-100",children:_.map((e,t)=>(0,a.jsx)("div",{className:"w-100",children:(0,a.jsx)(v,{images:F,currentPage:y,onPageChange:S,mucluc:T,pageSingle:!0})},"".concat(e.number,"-").concat(t)))})}),(0,a.jsxs)("div",{ref:I,className:"sidebar d-md-block ".concat(k?"open":"closed"," ").concat(D?"scrolled":""),children:[(0,a.jsx)("button",{className:"toggle-btn",onClick:()=>C(!k),children:k?"⏪ Ẩn":"\uD83D\uDCD6 Mục lục"}),k&&(0,a.jsxs)("div",{className:"toc",children:[(0,a.jsx)("h3",{className:"toc-title fs-4 text-primary fw-bold",children:"\uD83D\uDCD1 Mục lục"}),j.map((e,t)=>(0,a.jsxs)("div",{className:"lesson mb-2 ".concat(B===t?"open":""),children:[(0,a.jsxs)("div",{className:"lesson-title fs-5 text-dark  bg-light p-2 rounded-top d-flex justify-content-between align-items-center",style:{cursor:"pointer"},onClick:()=>H(B===t?null:t),children:[(0,a.jsxs)("span",{children:["B\xe0i ",t+1,". ",e.name]}),(0,a.jsx)("span",{children:B===t?"\uD83D\uDD3D":"▶️"})]}),B===t&&(0,a.jsx)("ul",{className:"item-list mb-0 border-start ps-3",children:e.content.map((e,t)=>{var n;return(0,a.jsxs)("li",{className:"item fs-6 text-secondary p-2 border-bottom ".concat(w===(null===(n=e.pagenum)||void 0===n?void 0:n.toString().split(";")[0])?"active":""),onClick:()=>{var t;return N(Number(null===(t=e.pagenum)||void 0===t?void 0:t.toString().split(";")[0]))},style:{cursor:"pointer"},children:[t+1,". ",e.name," ",(0,a.jsxs)("span",{className:"text-muted",children:["(tr. ",e.pagenum,")"]})]},e.number)})})]},e.id))]})]}),(0,a.jsx)("div",{className:"d-lg-block d-none ".concat(k?"closed":"openmucluc"," ").concat(D?"scrolled":""),children:(0,a.jsx)(s.Z,{variant:"primary",onClick:()=>C(!k),children:"\uD83D\uDCD6"})}),(0,a.jsxs)("div",{style:{flex:1},children:[(0,a.jsx)(v,{images:U,currentPage:w,onPageChange:N,mucluc:j,showMucluc:()=>C(!k)}),(0,a.jsxs)("div",{className:"d-flex align-items-center justify-content-center",children:[(0,a.jsx)(s.Z,{variant:"primary",onClick:()=>C(!k),children:"\uD83D\uDCD6 Mục lục"}),M&&(0,a.jsx)(s.Z,{variant:"danger",onClick:()=>{_.length>0&&S(_[0].pagethamchieu),Z(!0)},children:"Check Đ\xe1p \xc1n"}),p&&(0,a.jsx)(g.default,{href:"/book/".concat(t,"/edit"),target:"_self",children:(0,a.jsx)(s.Z,{variant:"warning",children:"Edit"})})]})]})]}),isStudy:!0})}},32608:function(e,t,n){"use strict";var a=n(57437),r=n(2265),l=n(12808);n(9339),t.Z=(0,r.forwardRef)((e,t)=>{let{mp3:n,tieude:s,mp3gianthelist:c,mp3tiengtrunglist:o,mp3pinyinlist:u,mp3nghialist:d,mp3timelinelist:m,isShowPinyin:h,isGianthe:p,isPlayBgMusic:f}=e,v=(0,r.useRef)(null),g=(0,r.useRef)(null),[x,j]=(0,r.useState)(!1),[b,w]=(0,r.useState)(0),[N,y]=(0,r.useState)(0),[S,k]=(0,r.useState)(1),[C,D]=(0,r.useState)(-1),[E,M]=(0,r.useState)(!1),L=e=>e?"".concat(Math.floor(e/60).toString().padStart(2,"0"),":").concat(Math.floor(e%60).toString().padStart(2,"0")):"00:00",R=e=>{let t=parseFloat(e.target.value);k(t),v.current&&(v.current.playbackRate=t)},Z=()=>v.current?L(v.current.currentTime):"00:00";return(0,r.useImperativeHandle)(t,()=>({getCurrentTime:Z})),(0,r.useEffect)(()=>{if("1"==f)return g.current=new Audio("https://tiengtrungdongyang.com/mp3/bg/".concat(Math.floor(9*Math.random())+1,".mp3")),g.current.volume=.15,()=>{g.current&&(g.current.pause(),g.current.currentTime=0,g.current=null)}},[n]),(0,a.jsx)("div",{children:n&&(0,a.jsxs)("div",{className:"d-flex align-items-center bg-dark text-white p-3 m-2 rounded",children:[(0,a.jsx)(l.Z,{variant:x?"warning":"success",onClick:()=>{v.current&&(x?(v.current.pause(),"1"==f&&setTimeout(()=>{g.current.pause()},1e3)):"1"==f?(g.current.play(),setTimeout(()=>{v.current.play()},1e3)):v.current.play(),j(!x))},className:"me-2",children:x?"⏸":"▶"}),(0,a.jsx)("input",{type:"range",min:"0",max:N||100,value:b,onChange:e=>{if(v.current){let t=parseFloat(e.target.value);v.current.currentTime=t,"1"==f&&(g.current.currentTime=t),w(t)}},className:"form-range w-50 me-2"}),(0,a.jsxs)("span",{className:"me-2",children:[L(b)," / ",L(N)]}),(0,a.jsxs)("select",{value:i(S),onChange:e=>R(e),className:"form-select form-select-sm me-2",style:{width:"auto"},children:[(0,a.jsx)("option",{value:"0.5",children:"0.5x"}),(0,a.jsx)("option",{value:"0.75",children:"0.75x"}),(0,a.jsx)("option",{value:"1.0",children:"1.0x"}),(0,a.jsx)("option",{value:"1.25",children:"1.25x"}),(0,a.jsx)("option",{value:"1.5",children:"1.5x"}),(0,a.jsx)("option",{value:"1.75",children:"1.75x"}),(0,a.jsx)("option",{value:"2.0",children:"2.0x"})]}),(0,a.jsx)(l.Z,{variant:"outline-primary",href:n,download:"".concat(s||"audio",".mp3"),className:"ms-3",children:(0,a.jsx)("i",{className:"fa-solid fa-circle-down"})}),(0,a.jsx)("audio",{ref:v,src:n,onTimeUpdate:()=>{v.current&&w(v.current.currentTime)},onLoadedMetadata:()=>{v.current&&y(v.current.duration)},onEnded:()=>{j(!1),g.current&&setTimeout(()=>{g.current.pause(),g.current.currentTime=0},1e3)}})]})})});let s=["0.5","0.75","1.0","1.25","1.5","1.75","2.0"],i=e=>s.reduce((t,n)=>Math.abs(parseFloat(n)-e)<Math.abs(parseFloat(t)-e)?n:t)},67631:function(){},16896:function(){},9339:function(){}},function(e){e.O(0,[2866,9513,5527,431,7539,8223,4358,7481,9208,9461,8765,4974,3539,8472,609,6901,6802,8551,7295,2971,7023,1744],function(){return e(e.s=3488)}),_N_E=e.O()}]);