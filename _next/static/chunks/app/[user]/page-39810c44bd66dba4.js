(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1157],{3823:function(e,a,t){Promise.resolve().then(t.bind(t,4456))},4456:function(e,a,t){"use strict";t.d(a,{default:function(){return f}});var i=t(7437),n=t(2265),l=t(8708),s=t(5606);t(9768);var r=t(5319),c=t(5749),m=t(3508),u=t(5720),o=t(6648),d=t(7138),g=t(2808),h=t(4379),v=t.n(h);function f(e){let{user:a}=e;var t=this;let[h,f]=(0,n.useState)({datas:null,usernames:null,dateTimes:null,tieudes:null,links:null,likes:null,comments:null,weblinks:null,tieudeTiengTrungs:null,authors:null,imgAuthors:null,baidichs:null,error:null,nav:!1,loading:!1,commentTexts:{},isLikedMap:{},flagLogin:!1,flagAdmin:!1,userData:{name:"",img:"",email:""},flagUpdate:!1,myUser:null}),[p,k]=(0,n.useState)(!0);(0,n.useEffect)(()=>{x()},[]);let x=async()=>{let e=localStorage.getItem("user"),t=localStorage.getItem("name"),i=JSON.parse(localStorage.getItem("allData"));if(!i)return;let n=i.find(e=>"dashboard"===e.key),l=i.find(e=>"account"===e.key),s=l.value[a];var r=Object.entries(n.value).map(e=>{let[a,t]=e;return{key:a,value:t}}),c=Object.entries(l.value).map(e=>{let[a,t]=e;return{key:a,value:t}});try{let a=await Promise.all(r.map(async a=>{let t=a.key,i=Object.entries(a.value).map(e=>{let[a,t]=e;return{key:a,value:t}}),n=await Promise.all(i.map(async a=>{let i="".concat(t,"&").concat(a.key);var n=a.value.comment?Object.entries(a.value.comment).map(e=>{let[a,t]=e;return{key:a,value:t}}):null,l=a.value.like?Object.entries(a.value.like).map(e=>{let[a,t]=e;return{key:a,value:t}}):null,s=a.value.tiengTrung?Object.entries(a.value.tiengTrung).map(e=>{let[a,t]=e;return{key:a,value:t}}):null,r=a.value.dichNghia?Object.entries(a.value.dichNghia).map(e=>{let[a,t]=e;return{key:a,value:t}}):null;let m=c.find(e=>e.key===t),[u,o,d,g,h,v,f,b,p,k,x,y,j,T,N]=await Promise.all([n,l,m.value.name,m.value.img,a.value.tieude,a.value.tieudeTiengTrung,a.value.author,a.value.imgAuthor,a.value.link,a.value.weblink,a.value.dateTime,a.value.id,a.value.baidich,s,r]),w=null,I=null,C=!1;return u&&(w=await Promise.all(u.map(async e=>{let a=u.find(a=>a.key===e.key),t=a.value.user,i=c.find(e=>e.key===t),[n,l,s,r]=await Promise.all([i.value.name,i.value.img,a.value.cmt,a.value.dateTime]);return{username:n,userImage:l,cmt:s,dateTime:r,id:e.key}}))),o&&(I=await Promise.all(o.map(async a=>{let t=o.find(e=>e.key===a.key);a.key===e&&(C=!0);let[i,n]=await Promise.all([t.value.name,t.value.image]);return{username:i,userImage:n}}))),{baivietKey:i,username:d,userImage:g,tieude:h,tieudeTiengTrung:v,author:f,imgAuthor:b,link:p,weblink:k,dateTime:x,comment:w,likes:I,id:y,baidich:j,isLiked:C,tiengTrungs:T,dichNghias:N}}));return{key:t,baivietDatas:n}})),i=[];a.forEach(e=>{i=i.concat(e.baivietDatas)}),i.sort((e,a)=>new Date(a.dateTime)-new Date(e.dateTime));let n={},l={},m={},u={},o={},d={},g={},h={},v={},b={},p={},k={},x={},y={},j={},T={};i.forEach(e=>{n[e.baivietKey]=e.weblink,l[e.baivietKey]=e.tieudeTiengTrung,m[e.baivietKey]=e.author,u[e.baivietKey]=e.link,o[e.baivietKey]=e.imgAuthor,d[e.baivietKey]=e.username,h[e.baivietKey]=e.tieude,g[e.baivietKey]=e.dateTime,v[e.baivietKey]=e.comment,b[e.baivietKey]=e.likes,p[e.baivietKey]=e.id,k[e.baivietKey]=e.userImage,x[e.baivietKey]=e.baidich,y[e.baivietKey]=e.isLiked,j[e.baivietKey]=e.tiengTrungs,T[e.baivietKey]=e.dichNghias});let N=i;f(a=>({...a,datas:N,myUser:e,MyUserName:t,baidichs:x,weblinks:n,tieudeTiengTrungs:l,authors:m,imgAuthors:o,links:u,usernames:d,userImages:k,tieudes:h,dateTimes:g,comments:v,likes:b,ids:p,isLikedMap:y,loading:!1,tiengTrungs:j,dichNghias:T,userData:s,myUser:e}))}catch(e){f({error:e,loading:!1}),console.error("Error fetching data:",e)}},y=async()=>{let e=localStorage.getItem("user"),{userData:a}=h;console.log(a.name);try{await (0,s.Pf)("/users/account/".concat(e,"/name"),a.name),await (0,s.Pf)("/users/account/".concat(e,"/img"),a.img),await v().fire({position:"center",icon:"success",title:"Cập nhật th\xe0nh c\xf4ng",showConfirmButton:!1,timer:1500}),K()}catch(e){console.error("Lỗi tạo b\xe0i mới:",e),v().fire("Lỗi tạo b\xe0i mới: "+e.message,"","info")}},j=async function(e,a){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(await (0,s.Z6)(e),i){let i=e.split("/").pop();t.setState(e=>({comments:{...e.comments,[a]:e.comments[a].filter(e=>e.id!==i)}}))}else f(e=>({datas:e.datas.filter(e=>e.baivietKey!==a),baidichs:T(e.baidichs,a),weblinks:T(e.weblinks,a),tieudeTiengTrungs:T(e.tieudeTiengTrungs,a),authors:T(e.authors,a),imgAuthors:T(e.imgAuthors,a),links:T(e.links,a),usernames:T(e.usernames,a),userImages:T(e.userImages,a),tieudes:T(e.tieudes,a),dateTimes:T(e.dateTimes,a),comments:T(e.comments,a),likes:T(e.likes,a),ids:T(e.ids,a),tiengTrungs:T(e.tiengTrungs,a),dichNghias:T(e.dichNghias,a)}))},T=(e,a)=>{let{[a]:t,...i}=e;return i},N=async(e,a)=>{let t=this.state.commentTexts[a],i=localStorage.getItem("user"),n=localStorage.getItem("name"),l=localStorage.getItem("userImage");if(i){let r="".concat(e,"/comment"),c=await (0,s.UD)(r),u=new Date().toISOString(),o=null;o=c?c.length+1:1;let d="".concat(o,"-").concat((0,m.o0)(u));await (0,s.Pf)("".concat(r,"/").concat(d,"/user"),i),await (0,s.Pf)("".concat(r,"/").concat(d,"/cmt"),t),await (0,s.Pf)("".concat(r,"/").concat(d,"/dateTime"),u);let g={username:n,userImage:l,cmt:t,dateTime:u,id:d};f(e=>({comments:{...e.comments,[a]:[...e.comments[a]||[],g]},commentTexts:{...e.commentTexts,[a]:""}}))}},w=async(e,a,t)=>{let i=localStorage.getItem("user"),n=localStorage.getItem("name"),l=localStorage.getItem("userImage");if(i){let r="".concat(e,"/like");if(t)await (0,s.Z6)("".concat(r,"/").concat(i)),f(e=>({likes:{...e.likes,[a]:e.likes[a].filter(e=>e.username!==n)},isLikedMap:{...e.isLikedMap,[a]:!1}}));else{await (0,s.Pf)("".concat(r,"/").concat(i,"/name"),n),await (0,s.Pf)("".concat(r,"/").concat(i,"/image"),l);let e={username:n,userImage:l};f(t=>({likes:{...t.likes,[a]:[...t.likes[a]||[],e]},isLikedMap:{...t.isLikedMap,[a]:!0}}))}}},I=(e,a)=>{f(t=>({commentTexts:{...t.commentTexts,[e]:a.target.value}}))},C=(e,a,t)=>(0,i.jsx)("div",{children:a&&a.map((a,n)=>(0,i.jsx)(b,{imgUser:a.userImage,username:a.username,cmt:a.cmt,dateTime:a.dateTime,removeClick:()=>j("".concat(e,"/comment/").concat(a.id),t,!0)},n))}),K=()=>{f(e=>({...e,flagUpdate:!e.flagUpdate}))},S=e=>{let{name:a,value:t}=e.target;f(e=>({...e,userData:{...e.userData,[a]:t}}))};return(0,i.jsx)(l.Z,{body:(0,i.jsxs)("div",{className:"container",children:[(()=>{let{userData:e,flagUpdate:t,myUser:n}=h;if(!e)return;let l=e.img?e.img:c.Z;return(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"userDataContainer",children:[(0,i.jsx)("div",{className:"userDataImage",children:(0,i.jsx)(d.default,{href:"",passHref:!0,legacyBehavior:!0,children:(0,i.jsx)(o.default,{src:l,alt:"null",width:300,height:300})})}),!t&&(0,i.jsxs)("div",{className:"userDataInfo",children:[(0,i.jsx)("h3",{children:e.name}),(0,i.jsx)("br",{}),n==a&&(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,i.jsx)("i",{className:"nav-icon fa-solid fa-user-pen"}),(0,i.jsx)("div",{className:"update-personal",onClick:()=>K(),children:"Chỉnh sửa th\xf4ng tin c\xe1 nh\xe2n"})]})]}),t&&(0,i.jsxs)("div",{className:"userDataInfo",children:[(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("h5",{children:"T\xean của bạn"}),(0,i.jsx)("input",{type:"text",className:"form-control",name:"name",placeholder:"Nhập t\xean của bạn",value:e.name,onChange:S})]}),(0,i.jsx)("br",{}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("h5",{children:"Đường dẫn ảnh đại diện của bạn"}),(0,i.jsx)("input",{type:"text",className:"form-control",name:"img",id:"","aria-describedby":"helpId",placeholder:"Nhập đường dẫn ảnh đại diện của bạn",value:e.img,onChange:S})]}),(0,i.jsx)("br",{}),(0,i.jsx)(g.Z,{variant:"info",onClick:()=>y(),children:"Cập nhật"}),(0,i.jsx)(g.Z,{variant:"danger",children:"Hủy"})]}),(0,i.jsx)("br",{})]})]}),(0,i.jsx)("hr",{})]})})(),(()=>{let{datas:e,baidichs:t,userImages:n,usernames:l,commentTexts:s,likes:c,dateTimes:m,comments:o,tieudes:d,tieudeTiengTrungs:g,ids:v,isLikedMap:f,tiengTrungs:b,dichNghias:p}=h;var k=!1;return e&&e.length>0?(e.map((e,t)=>{e.baivietKey.split("&")[0]==a&&(k=!0)}),k)?e.map((e,h)=>{let k=e.baivietKey,x=k.split("&")[0];if(x!=a)return null;let y="/users/dashboard/".concat(x,"/").concat(k.split("&")[1]);return(0,i.jsx)(r.Z,{username:l[k]||null,dateTime:m[k]||null,imgUser:n[k]||null,comment:o[k]?C(y,o[k],k):null,likes:c[k]?(0,i.jsx)(u.Z,{likes:c[k]}):null,tieudeTiengTrung:g[k]||null,link:k?"/dashboard/".concat(x,"/").concat(k.split("&")[1]):null,title:d[k]||null,baidich:t[k]||null,img:v[k]?"https://img.youtube.com/vi/".concat(v[k],"/sddefault.jpg"):null,removeClick:()=>j(y,k,!1),sendCmtHandle:()=>N(y,k),commentText:s[k]||"",onChangeHandle:e=>I(k,e),likeClick:()=>w(y,k,f[k]),isLiked:f[k],tiengTrungs:b[k]||null,dichNghias:p[k]||null},h)}):(0,i.jsx)("div",{children:(0,i.jsx)("h2",{children:"Bạn chưa c\xf3 b\xe0i đăng n\xe0o"})}):null})()]})})}function b(e){return(0,i.jsxs)("div",{className:"itemCard-UserName",children:[(0,i.jsxs)("div",{className:"itemCard-UserName-2",children:[(0,i.jsx)(o.default,{src:e.imgUser?e.imgUser:c.Z,alt:"img",width:500,height:500}),(0,i.jsxs)("div",{className:"itemCard-UserName-container ",children:[(0,i.jsxs)("div",{className:"itemCard-UserName-container-1",children:[(0,i.jsx)("h6",{className:"username-card1",children:e.username}),(0,i.jsx)("p",{children:e.cmt})]}),(0,i.jsx)("span",{className:"Time",style:{margin:"0"},children:(0,m.o0)(e.dateTime)})]})]}),localStorage.getItem("name")==e.username?(0,i.jsx)("div",{className:"itemCard-UserName-1",children:(0,i.jsx)("button",{className:"btn btn-options",onClick:e.removeClick,style:{padding:"0",margin:"0"},children:(0,i.jsx)("i",{className:"fa-solid fa-trash"})})}):null]})}}},function(e){e.O(0,[4358,7481,9208,9461,5617,7138,7143,8472,609,8423,4323,2971,7023,1744],function(){return e(e.s=3823)}),_N_E=e.O()}]);