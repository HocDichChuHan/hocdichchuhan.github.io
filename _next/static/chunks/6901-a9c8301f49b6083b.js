"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6901],{1409:function(e,t,n){function r(e){let{src:t,width:n,quality:r}=e;return"".concat("").concat(t)}n.r(t),n.d(t,{default:function(){return r}})},5202:function(e,t,n){n.d(t,{Z:function(){return d}});var r=n(7437),i=n(2265),c=n(5606),o=n(516),a=n(2808),l=n(7143),s=n(6648),u=n(4379),h=n.n(u);function d(e){let{isStudy:t}=e,[n,u]=(0,i.useState)(null),[d,g]=(0,i.useState)(!1);(0,i.useRef)(null),(0,i.useEffect)(()=>{let e=localStorage.getItem("userLogin");if(e){let n=JSON.parse(e);if(u(n),!t)return;(0,c.o3)(n.uid,c.db),g(!0)}},[t]),(0,i.useEffect)(()=>{if(!n)return;let e=(0,o.iH)(c.db,"user/status/".concat(n.uid)),t=(0,o.jM)(e,e=>{var t;g(e.exists()&&(null===(t=e.val())||void 0===t?void 0:t.isOnline))});return()=>t()},[n,d]),(0,i.useEffect)(()=>(window.addEventListener("beforeunload",f),()=>window.removeEventListener("beforeunload",f)),[]);let f=async()=>{let e=JSON.parse(localStorage.getItem("userLogin"));e&&(await (0,c.Z3)(e.uid,c.db),g(!1))};(0,i.useEffect)(()=>{if(!n||!t)return;let e=setInterval(()=>{(async()=>{await (0,c.Z3)(n.uid,c.db),g(!1),(await h().fire({title:"\uD83E\uDDE0 Bạn vẫn đang học chứ?",text:"Vui l\xf2ng x\xe1c nhận để tiếp tục phi\xean học.",icon:"question",showCancelButton:!1,confirmButtonText:"Đang học",cancelButtonText:"Tạm nghỉ"})).isConfirmed?(g(!0),await (0,c.o3)(n.uid,c.db),console.log("✅ Người d\xf9ng x\xe1c nhận đang học")):console.log("⏸️ Người d\xf9ng tạm nghỉ")})()},18e5);return()=>clearInterval(e)},[n]),(0,i.useEffect)(()=>{if(!n||!t||!d)return;let e=setInterval(async()=>{let e=new Date().toISOString().slice(0,10),t=(0,o.iH)(c.db,"user/activityLogs/".concat(n.uid,"/").concat(e)),r=await (0,o.U2)(t);if(r.exists()){let e=r.val(),n=new Date(e.currentSessionStart),i=new Date;if(!isNaN(n.getTime())){let r=(e.totalSeconds||0)+Math.floor((i-n)/1e3);await (0,o.t8)(t,{...e,totalSeconds:r,currentSessionStart:i.toISOString()}),console.log("⏱️ Cập nhật realtime:",r,"gi\xe2y")}}},6e4);return()=>clearInterval(e)},[n,t,d]);let m=async()=>{try{let e=await (0,c.Cb)();console.log(e);let t=e.user,n="user/account/".concat(t.uid),r=(0,o.iH)(c.db,n);if((await (0,o.U2)(r)).exists())console.log("\uD83D\uDCE6 User đ\xe3 tồn tại tr\xean Realtime Database");else{let e={uid:t.uid,name:t.displayName,email:t.email,photoURL:t.photoURL,createdAt:new Date().toISOString()};await (0,o.t8)(r,e),console.log("\uD83C\uDD95 Tạo user mới tr\xean Realtime Database")}let i={uid:t.uid,name:t.displayName,email:t.email,photoURL:t.photoURL};localStorage.setItem("userLogin",JSON.stringify(i)),u(i),await (0,c.o3)(t.uid)}catch(e){console.error("❌ Lỗi đăng nhập:",e)}},S=async()=>{let e=JSON.parse(localStorage.getItem("userLogin"));e&&await (0,c.Z3)(e.uid,c.db),(0,c.kS)(),localStorage.removeItem("userLogin"),u(null)};return(0,r.jsx)("div",{className:"d-flex align-items-center gap-3",children:n?(0,r.jsxs)("div",{className:"d-flex align-items-center position-relative",children:[(0,r.jsx)("span",{className:"me-2 fw-semibold text-white d-none d-sm-inline",children:n.name}),(0,r.jsxs)(l.Z,{align:"end",children:[(0,r.jsx)(l.Z.Toggle,{variant:"light",id:"dropdown-avatar",className:"p-0 border-0 bg-transparent",children:(0,r.jsx)(s.default,{src:n.photoURL,alt:"avatar",width:"40",height:"40",className:"rounded-circle border border-1"})}),(0,r.jsxs)(l.Z.Menu,{children:[(0,r.jsx)(l.Z.Item,{href:"/profile",children:"Trang c\xe1 nh\xe2n"}),(0,r.jsx)(l.Z.Divider,{}),(0,r.jsx)(l.Z.Item,{onClick:()=>S(),children:"Đăng xuất"})]})]})]}):(0,r.jsx)(a.Z,{onClick:()=>m(),className:"btn btn-primary",children:"Đăng nhập bằng Google"})})}},5606:function(e,t,n){n.d(t,{Cb:function(){return k},F3:function(){return m},Gd:function(){return y},Je:function(){return s},Pf:function(){return h},Tn:function(){return u},UD:function(){return w},VP:function(){return f},Z3:function(){return L},Z6:function(){return g},_g:function(){return d},db:function(){return l},eO:function(){return S},kS:function(){return D},kX:function(){return b},o3:function(){return I}});var r=n(5236);n(9675);var i=n(5735),c=n(516),o=n(9842);let a=(0,r.ZF)({apiKey:"AIzaSyD9IyIValBX6xooTZ3wsBPfKsyYvNwAWik",authDomain:"dichchuhan-55a4d.firebaseapp.com",databaseURL:"https://dichchuhan-55a4d-default-rtdb.firebaseio.com",projectId:"dichchuhan-55a4d",storageBucket:"dichchuhan-55a4d.appspot.com",messagingSenderId:"589658521880",appId:"1:589658521880:web:65694d6b4f17f4ca6b1e6d",measurementId:"G-G02KSBMR52"}),l=(0,c.N8)(a);function s(){var e=document.getElementById("fileList").value,t=document.querySelector(".content-right").value,n={[e]:t},r="/users/user1/kecheng/".concat(e),i="/users/user1/contents/".concat(e),o=(0,c.iH)(l,i);(0,c.t8)(o,n).then(()=>{console.log("Dữ liệu b\xe0i dịch đ\xe3 được ghi th\xe0nh c\xf4ng l\xean Firebase.")}).catch(e=>{console.error("Lỗi khi ghi dữ liệu b\xe0i dịch:",e)}),o=(0,c.iH)(l,r),n={[e]:t=document.querySelector(".content-left").value},(0,c.t8)(o,n).then(()=>{console.log("Dữ liệu kecheng đ\xe3 được ghi th\xe0nh c\xf4ng l\xean Firebase.")}).catch(e=>{console.error("Lỗi khi ghi dữ liệu kecheng:",e)})}function u(e){var t={[e]:"".concat(e," phần dịch")},n="/users/user1/kecheng/".concat(e),r="/users/user1/contents/".concat(e),i=(0,c.iH)(l,r);(0,c.t8)(i,t).then(()=>{console.log("Dữ liệu b\xe0i dịch đ\xe3 được ghi th\xe0nh c\xf4ng l\xean Firebase.")}).catch(e=>{console.error("Lỗi khi ghi dữ liệu b\xe0i dịch:",e)}),i=(0,c.iH)(l,n),t={[e]:"".concat(e," 中文")},(0,c.t8)(i,t).then(()=>{console.log("Dữ liệu kecheng đ\xe3 được ghi th\xe0nh c\xf4ng l\xean Firebase.")}).catch(e=>{console.error("Lỗi khi ghi dữ liệu kecheng:",e)})}async function h(e,t){var n=(0,c.iH)(l,e);try{return await (0,c.t8)(n,t),!0}catch(e){throw console.error("C\xf3 lỗi xảy ra:",e),e}}function d(e){var t=(0,c.iH)(l,"/users/user1/contents/".concat(e));(0,c.Od)(t).then(()=>{console.log("Dữ liệu b\xe0i dịch đ\xe3 được x\xf3a th\xe0nh c\xf4ng từ Firebase.")}).catch(e=>{console.error("Lỗi khi x\xf3a dữ liệu b\xe0i dịch:",e)}),t=(0,c.iH)(l,"/users/user1/kecheng/".concat(e)),(0,c.Od)(t).then(()=>{console.log("Dữ liệu kecheng đ\xe3 được x\xf3a th\xe0nh c\xf4ng từ Firebase.")}).catch(e=>{console.error("Lỗi khi x\xf3a dữ liệu kecheng:",e)})}async function g(e){var t=(0,c.iH)(l,e);try{return await (0,c.Od)(t),!0}catch(e){throw console.error("C\xf3 lỗi xảy ra:",e),e}}function f(){var e=document.getElementById("fileList").value,t="/users/user1/kecheng/".concat(e,"/").concat(e),n="/users/user1/contents/".concat(e,"/").concat(e);console.log(t),console.log(m(n)),m(n).then(e=>{null!==e&&(document.querySelector(".content-right").value=e)}).catch(e=>{console.error("C\xf3 lỗi xảy ra:",e)}),m(t).then(e=>{null!==e&&(document.querySelector(".content-left").value=e)}).catch(e=>{console.error("C\xf3 lỗi xảy ra:",e)})}function m(e){return new Promise((t,n)=>{var r=(0,c.iH)(l,e);(0,c.U2)(r).then(e=>{e.exists()?t(e.val()):(console.log("Kh\xf4ng c\xf3 dữ liệu tại đường dẫn n\xe0y."),t(null))}).catch(e=>{console.error("Lỗi khi đọc dữ liệu:",e),n(e)})})}async function S(e){var t=(0,c.iH)(l,e);try{var n=await (0,c.U2)(t);if(n.exists())return n.val();return null}catch(e){return console.error("Lỗi khi đọc dữ liệu:",e),null}}function w(e){return new Promise((t,n)=>{var r=(0,c.iH)(l,e);(0,c.U2)(r).then(e=>{e.exists()?t(Object.entries(e.val()).map(e=>{let[t,n]=e;return{key:t,value:n}})):t(null)}).catch(e=>{console.error("Lỗi khi đọc dữ liệu:",e),n(e)})})}(0,o.ad)(a);let v="users/user1/contents";async function y(){let e=(0,c.iH)(l,v),t=await (0,c.U2)(e);t.exists()?(p(Object.keys(t.val())),f()):console.log("Kh\xf4ng c\xf3 dữ liệu tại đường dẫn n\xe0y.")}async function b(e){let t=(0,c.iH)(l,v),n=await (0,c.U2)(t);if(n.exists()){var r,i;p(Object.keys(n.val())),r="/users/user1/kecheng/".concat(e,"/").concat(e),i="/users/user1/contents/".concat(e,"/").concat(e),document.getElementById("fileList").value=e,m(i).then(e=>{null!==e&&(document.querySelector(".content-right").value=e)}).catch(e=>{console.error("C\xf3 lỗi xảy ra:",e)}),m(r).then(e=>{null!==e&&(document.querySelector(".content-left").value=e)}).catch(e=>{console.error("C\xf3 lỗi xảy ra:",e)})}else console.log("Kh\xf4ng c\xf3 dữ liệu tại đường dẫn n\xe0y.")}function p(e){let t=document.getElementById("fileList");for(;t.firstChild;)t.removeChild(t.firstChild);e.forEach(e=>{let n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)})}let x=(0,i.v0)(a);async function k(){let e=new i.hJ;try{return await (0,i.rh)(x,e)}catch(e){throw console.error("Lỗi đăng nhập:",e),e}}new i.hJ;let D=async()=>{if(!x.currentUser){console.warn("No user currently signed in.");return}try{await (0,i.w7)(x),console.log("User signed out")}catch(e){console.error("Logout failed:",e)}},I=async e=>{let t=new Date().toISOString().slice(0,10),n=(0,c.iH)(l,"user/activityLogs/".concat(e,"/").concat(t)),r=(0,c.iH)(l,"user/status/".concat(e));(await (0,c.U2)(n)).exists()?await (0,c.Vx)(n,{currentSessionStart:new Date().toISOString()}):await (0,c.t8)(n,{currentSessionStart:new Date().toISOString(),totalSeconds:0}),console.log("markUserOnline"),await (0,c.t8)(r,{isOnline:!0,timestamp:new Date().toISOString()}),(0,c.ae)(r).set({isOnline:!1,timestamp:new Date().toISOString()})},L=async e=>{let t=new Date().toISOString().slice(0,10),n=(0,c.iH)(l,"user/activityLogs/".concat(e,"/").concat(t)),r=(0,c.iH)(l,"user/status/".concat(e)),i=await (0,c.U2)(n);if(i.exists()){let e=i.val(),t=new Date(e.currentSessionStart),r=new Date;if(isNaN(t.getTime())){console.warn("⚠️ currentSessionStart kh\xf4ng hợp lệ:",e.currentSessionStart);return}let o=Math.floor((r-t)/1e3),a="number"==typeof e.totalSeconds?e.totalSeconds:0;if(isNaN(o)||isNaN(a)){console.warn("⚠️ Gi\xe1 trị thời gian kh\xf4ng hợp lệ:",{sessionSeconds:o,previousTotal:a});return}await (0,c.Vx)(n,{endTime:r.toISOString(),totalSeconds:a+o,currentSessionStart:null})}await (0,c.t8)(r,{isOnline:!1,timestamp:new Date().toISOString()})}}}]);